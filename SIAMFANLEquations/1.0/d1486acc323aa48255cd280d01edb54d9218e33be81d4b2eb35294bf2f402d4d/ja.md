aasol(GFix!, x0, m, Vstore; maxit=20,       rtol=1.e-10, atol=1.e-10, beta=1.0, pdata=nothing, keepsolhist = false)

C. T. Kelley, 2022

Juliaコードによるアンダーソン加速。特に派手なものではありません。

解法は固定点問題 x = G(x) です。

関数と固定点マップの履歴のためにストレージを確保する必要があります –> 呼び出しプログラム内で <– 配列 Vstore に。

n次元問題で Anderson(m) を使用する場合、Vstore は少なくとも 2m + 4 列を持つ必要があり、3m + 3 の方が良いです。 m=0（ピカール）の場合、V は少なくとも 4 列を持つ必要があります。

入力:

  * GFix!: 固定点マップ、! は GFix! が G を上書きすることを示します。あなたの事前に確保されたストレージは G=G(xin) です。

    したがって G=GFix!(G,xin) または G=GFix!(G,xin,pdata) は G=G(xin) を返します。

    あなたの GFix 関数は必ず –> return G <– で終わる必要があります。ドキュメントの例を参照してください。
  * x0: 初期反復。サイズ N のベクトルです。

    (N) として保存し、G! をサイズ (N) のベクトルを使用するように設計する必要があります。代わりに (N,1) を一貫して使用すると、ソルバーは動作するかもしれませんが、保証はできません。
  * m: アンダーソン加速の深さ。m=0 はピカール反復です。
  * Vstore: 作業ストレージ配列。n次元問題の場合、Vstore は少なくとも 3m+3 列を持つ必要があります。ストレージに制約がある場合は、最小限 2m+4 列を確保できます。小さいストレージ割り当ては、特に小さな問題や小さな m の値に対してパフォーマンスのペナルティを課します。したがって、Anderson(3) の場合、Vstore は zeros(N,8) より小さくてはならず、zeros(N,11) がより良い選択です。Vstore は残差と固定点マップの差の履歴を確保する必要があります。追加の m-1 列は、最適化問題の係数行列の QR 因子分解のダウンドレーティングフェーズで中間結果を保存するためのものです。この混乱の詳細については、ノートブックまたは印刷された本を参照してください。

    m=0 の場合、Vstore は 4 列が必要です。

キーワード引数 (kwargs):

maxit: デフォルト = 20

非線形反復の制限

rtol と atol: デフォルト = 1.e-10

相対および絶対誤差許容値

beta:

アンダーソン混合パラメータ。G(x) を (1-beta)x + beta G(x) に変更します。減衰ピカール反復を加速するのと同等です。履歴ベクトルは減衰固定点マップのものであり、元のものではありません。結果を比較する際にはこれを念頭に置いてください。

pdata:

固定点マップのための事前計算データ。関数内のグローバル変数にデータを隠すよりも、これを使用した方がうまくいきます。

keepsolhist: デフォルト = false

これを true に設定すると、出力タプルに反復の履歴が得られます。これはスカラー方程式の場合はデフォルトでオンで、システムの場合はオフです。データが本当に大きくなる可能性があるため、データを使用する必要がある場合にのみオンにしてください。

出力:

  * 名前付きタプル (solution, functionval, history, stats, idid,              errcode, solhist)

ここで

– solution = 収束した結果

– functionval = G(solution)       収束したアンダーソン結果に適用されたピカール反復であるため、functionval を解として使用することをお勧めします。G が収縮であれば、解よりも良い結果になるでしょう。

– history = 反復の残差ノルム (||x-G(x)||) のベクトル

– stats = 名前付きタプル (condhist, alphanorm) 最適化問題の条件数の履歴と係数の l1 ノルム。

これは問題の診断と研究のためだけです。Condihist[k] と alphanorm[k] は、反復 k から反復 k+1 を計算する最適化問題の条件数と係数ノルムです。

私は k=1 から最終反復 K までの反復のためにこれを記録します。したがって、k=0 または最終反復のための統計は記録しません。最終反復のデータは、追加の最適化問題の解決のコストで Toth/Kelley 2015 で記録しました。すでに終了しているため、そのデータを収集する意味はありません。

要するに: 履歴が反復 0 ... K の長さ K+1 を持つ場合、condhist と alphanorm は長さ K-1 になります。

– idid=true は反復が成功した場合、false はそうでない場合。

– errcode = 0 は反復が成功した場合

```
    = -1 は初期反復が終了基準を満たす場合

    = -2 は || residual || > div_test || residual_0 ||
         現在、div_test = 1.e4 に固定しています。これが発生した場合、Inf や NaN を生成しないように反復を終了します。

    = 10 は maxit 回の反復後に収束しなかった場合
```

– solhist:

これが、keepsolhist=true に設定した場合の反復の全履歴です。

solhist は N x K の配列で、N は x の長さ、K は反復の数 + 1 です。

### aasol の例

#### Toth-Kelley 2015 の表 1 を複製します。

条件数と係数ノルム統計の最終エントリは計算に使用されず、Julia では計算しません。ストーリーについては、ドキュメント、ノートブック、および印刷された本を参照してください。

```jldoctest
julia> function tothk!(G, u)
       G[1]=cos(.5*(u[1]+u[2]))
       G[2]=G[1]+ 1.e-8 * sin(u[1]*u[1])
       return G
       end
tothk! (generic function with 1 method)

julia> u0=ones(2,); m=2; vdim=3*m+3; Vstore = zeros(2, vdim);
julia> aout = aasol(tothk!, u0, m, Vstore; rtol = 1.e-10);
julia> aout.history
8-element Vector{Float64}:
 6.50111e-01
 4.48661e-01
 2.61480e-02
 7.25389e-02
 1.53107e-04
 1.18513e-05
 1.82466e-08
 1.04725e-13

julia> [aout.stats.condhist aout.stats.alphanorm]
6×2 Matrix{Float64}:
 1.00000e+00  1.00000e+00
 2.01556e+10  4.61720e+00
 1.37776e+09  2.15749e+00
 3.61348e+10  1.18377e+00
 2.54948e+11  1.00000e+00
 3.67694e+10  1.00171e+00
```

次に、beta = .5 の混合または減衰パラメータを追加します。この例は、混合がうまくいくようにするには十分に厄介です。履歴は元のものではなく、減衰残差のものであることを忘れないでください。

```
julia> bout=aasol(tothk!, u0, m, Vstore; rtol = 1.e-10, beta=.5);

julia> bout.history
7-element Vector{Float64}:
 3.25055e-01
 3.70140e-02
 1.81111e-03
 9.55308e-04
 1.25936e-05
 1.40854e-09
 2.18196e-12
```

#### m=2 の H 方程式の例。

これはニュートンよりも多くの反復を要しますが、誰も驚かないでしょう。

```jldoctest
julia> n=16; x0=ones(n,); Vstore=zeros(n,20); m=2;
julia> hdata=heqinit(x0,.99);
julia> hout=aasol(HeqFix!, x0, m, Vstore; pdata=hdata);
julia> hout.history
12-element Vector{Float64}:
 1.47613e+00
 7.47800e-01
 2.16609e-01
 4.32017e-02
 2.66867e-02
 6.82965e-03
 2.70779e-04
 6.51027e-05
 7.35581e-07
 1.85649e-09
 4.94803e-10
 5.18866e-12

```
