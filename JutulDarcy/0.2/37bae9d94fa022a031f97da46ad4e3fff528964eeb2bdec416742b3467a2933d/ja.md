```
model, parameters = setup_reservoir_model(reservoir, system; wells = [], <keyword arguments>)
model, parameters = setup_reservoir_model(reservoir, system; wells = [w1, w2], backend = :csr, <keyword arguments>)
```

与えられた貯水池 `DataDomain` のために貯水池 `MultiModel` を設定します。通常は [`reservoir_domain`](@ref) から設定され、オプションの井戸ベクトルは [`setup_vertical_well`](@ref) および [`setup_well`](@ref) を使用して作成されます。

このルーチンは、自動的に施設を設定し、井戸を貯水池およびその施設と結合します。

# キーワード引数

## 基本モデル設定

  * `wells=[]`: モデルで使用される井戸のベクトル（例: [`setup_well`](@ref) から）。各井戸は一意の名前を持つ必要があります。
  * `extra_out=true`: モデルだけでなく、モデルとパラメータの両方を返します。
  * `thermal = false`: エネルギーと温度の保存のための追加の方程式を主変数として追加します。
  * `kgrad=nothing`: 使用する空間離散化のタイプ：

      * `:tpfa` または `nothing` は、ハードコーディングされた二点アセンブリを持つ標準的な二点フラックス近似 (TPFA) を提供します。
      * `:tpfa_test` は、特化した有限体積アセンブリを持つ TPFA を提供します。`:tpfa` と同様の性能であるべきですが、スレッドを使用しません。
      * `:avgmpfa` は、異方性透過率や非直交セルを持つメッシュに対して `:tpfa` よりも正確な一貫した線形 MPFA スキームを提供します。
      * `:ntpfa` は、一貫した非線形 MPFA スキームを提供します（単調性を保持する `:avgmpfa` の非線形バージョン）。
  * `upwind=nothing`: 使用するアップウィンドのタイプ。標準的なアップウィンド用に `:spu` または `nothing`、または二次重み付き本質的に非振動的スキーム用に `:weno` を使用できます。
  * `extra_outputs=Symbol[]`: 貯水池モデルのための追加出力変数。デフォルトは貯水池シミュレーションで見られる「典型的」な値です。有効な値: 出力されるシンボルのベクトル、すべての変数のための `true`、およびシミュレーションを再起動するために必要な最小セットのための `false`（通常は主変数と各成分の質量のみ）。

## 高度なモデル設定

高度なオプションは、シミュレーターの内部を管理します。自動微分のタイプ、方程式の線形化方法などです。これらはモデルの許容範囲を超えてシミュレーション結果に影響を与えるべきではありませんが、シミュレーション速度には影響を与える可能性があります。

  * `split_wells=false`: すべての井戸を制御する1つの施設モデルの代わりに、各井戸のための施設モデルを追加します。MPIまたは非線形ドメイン分解を使用する場合は、これを `true` に設定する必要があります。
  * `backend=:csr`: 使用するバックエンド。シリアル圧縮スパース列 CSC 行列用に `:csc`、並列圧縮スパース行行列用に `:csr` を使用できます。`:csr` は少し速く、MPI、HYPRE、または複数のスレッドを使用する場合に推奨されます。`:csc` はデフォルトのJuliaフォーマットを使用し、他のJuliaライブラリと相互運用可能です。
  * `context=DefaultContext()`: モデル全体で使用されるコンテキスト。手動で設定することは推奨されず、代わりに `backend` を使用してください。
  * `assemble_wells_together=true`: 井戸を多くの小さな行列ではなく、1つの大きな行列に組み立てます。
  * `block_backend=true`: ブロックスパース表現を使用します。これは反復ソルバーおよび対応する前処理器に必要です。これを `false` に設定すると、直接ソルバーが使用されます。さらに、方程式はMRSTのような順序で組み立てられます（セルメジャーではなく方程式メジャー）。
  * `general_ad=false`: より一般的なADの形式を使用します。これを `true` に設定した場合よりも実行速度が遅くなりますが、カスタム離散化で作業する際に便利です。
  * `discretization_arg=NamedTuple()`: 離散化を設定する際に `discretized_domain_tpfv_flow` に渡される追加のキーワード引数。

## 増分および変数オプション

これらのオプションは、単一のニュートン反復におけるプロパティの値の範囲と最大許容変化を管理します。最大変化の値を変更しても方程式自体は変更されませんが、値は非線形ソルバーの収束速度を変更します。通常、より小さな値は保守的で数値的な困難を減少させますが、反復回数を大幅に増加させ、平均タイムステップの長さを減少させる可能性があります。非常に小さな値を設定すると、合理的な時間内に問題を解決することが不可能になる場合があります。

相対値は通常、セルの値に対して相対的に与えられます。期待される出力値がゼロに近い場合（例: 大気圧近く）、低い値は収束を遅くする可能性があります。

  * `dp_max_abs=nothing`: SI単位（Pa）での最大許容圧力変化
  * `dp_max_rel=0.2`: 最大許容相対圧力変化（デフォルトは20%）
  * `dp_max_abs_well=convert_to_si(50, :bar)`: SI単位（Pa）での井戸の最大許容圧力変化
  * `dp_max_rel_well=nothing`: 井戸での最大許容相対圧力変化
  * `ds_max=0.2`: 飽和度の最大変化
  * `dz_max=0.2`: 成分の最大変化（成分モデルのみ）
  * `p_min=JutulDarcy.DEFAULT_MINIMUM_PRESSURE`: モデル内の最小圧力（ハードリミット）
  * `p_max=Inf`: モデル内の最大圧力（ハードリミット）
  * `dr_max=Inf`: ニュートン反復中の黒油モデルにおける Rs/Rv の最大変化。セルの飽和値に対して相対的に取られます。
  * `dT_max_rel=nothing`: 温度の最大相対変化（JutulDarcyはケルビンを使用するため、上記のゼロ近くの制限を変更することに関するコメントは典型的な貯水池温度には適用されません）
  * `dT_max_abs=50.0`: 温度の最大絶対変化（°K/°C）
  * `T_min=convert_to_si(0.0, :Celsius)`: モデル内の最小温度（ハードリミット）
  * `fast_flash=false`: `flash_reuse_guess` と `flash_stability_bypass` を有効にするためのショートハンド。これらのオプションは、成分モデルのフラッシュソルバーでの時間を短縮するのに役立ちます。オプションは、Rasmussen et al（2006）による「成分、過渡シミュレーションのためのフラッシュ計算の計算速度を向上させる」 に基づいています。
  * `flash_reuse_guess=fast_flash`: セルが二相のままである場合、前のフラッシュ推測を再利用します。
  * `flash_stability_bypass=fast_flash`: 二相およびシャドウ領域の外にあるセルの安定性テストをバイパスします。
  * `can_shut_wells=true`: 繰り返し間違った側でレートを取得する井戸を閉じることを許可するように施設を構成します。これを無効にすると、特定のモデルのシミュレーションが不可能になる場合がありますが、井戸が稼働しているべきであることがわかっている単純なモデルでは有用です。
