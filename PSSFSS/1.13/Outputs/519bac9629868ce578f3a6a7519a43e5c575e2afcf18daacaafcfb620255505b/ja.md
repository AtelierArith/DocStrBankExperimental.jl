```
res2fresnel(results::Vector{Result}, fresnelfile::AbstractString)
res2fresnel(resultfile::AbstractString, fresnelfile::AbstractString)
```

`results`（`analyze`関数によって返される`Result`オブジェクトのベクター）からHFSS互換の「フレネルテーブル」ファイルを作成します。最初の位置引数が`AbstractString`の場合、それはPSSFSS結果ファイルの名前であると見なされ、その結果のベクターが読み込まれます。

フレネルテーブルは単一のϕ値のデータのみを含むため、入力された`result`ベクターが複数のϕ値のデータを含む場合、最小の大きさの値のみが使用されます。

フレネルテーブルは、反射係数のみを含むようにフォーマットされる場合（いわゆる「不透明」構造）、または反射係数と透過係数の両方を含む場合（「非不透明」構造）があります。不透明構造とは、一般化散乱行列のs21部分がすべての周波数とスキャン角度に対して同一にゼロである構造のことです。書き込まれる正しいフォーマットは、`res2fresnel`によって自動的に選択されます。

## フレネルテーブル互換性の要件

`results`のデータは以下の要件を満たさなければなりません：

1. インシデンス角度ではなく、増分位相が使用されなければなりません。
2. θ角度は0から始まり、最大のθ値まで均等に間隔を空けている必要があります。
3. θ値の増分は90に均等に割り切れる必要があります。
4. 複数の周波数が存在する場合、それらは均等に間隔を空けている必要があります。

フレネルテーブルは、0から90まで均等に間隔を空けたθ値を含む必要があります。入力として提供された`results`ベクターが90までのθ値をすべて含まない場合、最大の提供されたθ値に対応する散乱行列の値が、完全なフレネルテーブルを提供するために必要に応じて残りの角度の「スロット」にコピーされます。

フレネルテーブルを作成するために使用されるユニットセルのジオメトリにはいくつかの制限があります。まず、フレネルテーブルは単一のϕ値のデータのみを含みます。これは、分析されるジオメトリが構造の散乱行列が基本的にϕに依存しないものでなければならないことを意味します。反例として、ストリップグリッドは適切な構造ではありません。なぜなら、その散乱特性はϕに強く依存するからです。次に、フレネルテーブルはコポラライズ（TE → TEおよびTM → TM）の透過および反射係数のみを記録します。これは、分析される構造が重要な振幅のクロスポラライズ（TE → TMまたはTM → TE）の透過または反射係数を生成してはならないことを意味します。

フレネルテーブルは、単一の「前面」領域からの入射のみを考慮します。フレネルテーブルを作成する際、前面領域はPSSFSSモデルの領域1（すなわち、PSSFSSの`strata`ベクターに存在する最初の層）と見なされます。

### 非不透明構造に対する追加要件

HFSS SBR+モデルで使用される場合、フレネルテーブルから読み取られた散乱特性はゼロ厚の表面に適用され、透過光線は入射光線が遭遇した表面の同じ「ヒット」ポイントから発射されます。このため、PSSFSSモデルの入力ポートと出力ポートの位相基準面は、この前面（すなわち、`strata`ベクターの最初のインターフェース面）に位置する必要があります。これは、最初の`Layer`オブジェクトの幅をゼロに指定し（すなわち、最初の層に`Layer()`を使用し）、最終層の幅を`strata`ベクター内の他のすべての層の幅の合計の負の値に指定することで達成されます。負の幅の値は、出力ポートの基準面を入力ポートの基準面と一致させます。例として：

```julia
strata = [Layer(), Layer(width=2mm, ϵᵣ=2.2) Layer(width=3.3mm, ϵᵣ=3.0), Layer(width=2mm, ϵᵣ=2.2), Layer(width=-7.3mm)]
```
