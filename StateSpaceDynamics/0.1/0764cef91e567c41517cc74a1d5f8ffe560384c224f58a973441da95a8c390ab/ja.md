```
variational_expectation!(model::SwitchingLinearDynamicalSystem, y, FB, FS) -> Float64
```

スイッチング線形動的システムのための変分期待値（証拠下限、ELBO）を計算します。

# 引数

  * `model::SwitchingLinearDynamicalSystem`:   レジームの数（`K`）、システム行列（`B`）、および観測モデルなどのパラメータを含むスイッチング線形動的システムモデル。
  * `y`:   観測データで、通常は各列が特定の時間ステップでの観測を表す行列。
  * `FB`:   前方-後方オブジェクトで、責任（`γ`）を含む前方および後方パスに関連する変数を保持します。
  * `FS`:   各レジームのための`FilterSmooth`オブジェクトの配列で、平滑化された状態推定と共分散を格納します。

# 戻り値

  * `Float64`:   すべてのレジームと観測にわたって計算された総証拠下限（ELBO）。

# 説明

この関数は、スイッチング線形動的システムのための変分期待値ステップを実行し、以下の操作を実行します：

1. **責任の抽出**:   前方-後方オブジェクトから責任（`γ`）を取得し、その指数（`hs`）を計算します。
2. **並列平滑化および十分統計量の計算**:   各レジーム`k`について`1`から`model.K`まで、関数は：

      * `smooth`関数を使用して平滑化を行い、平滑化された状態（`x_smooth`）、共分散（`p_smooth`）、逆オフダイアゴナル項、および総エントロピーを取得します。
      * 平滑化された推定から十分統計量（`E_z`、`E_zz`、`E_zz_prev`）を計算します。
      * 現在のレジームのELBO寄与を計算し、それを`ml_total`に累積します。
3. **変分分布の更新**:  

      * 平滑化された状態から変分分布（`qs`）を計算し、これを`FB`に対する対数尤度として格納します。
      * 新しい`qs`に基づいて責任（`γ`）を更新するために前方および後方パスを実行します。
      * 更新された変分分布を反映するように責任（`γ`）を再計算します。
4. **ELBOの返却**:   蓄積されたELBO（`ml_total`）を返し、変分近似の質を定量化します。

# 例

```julia

# `model`はKレジームを持つSwitchingLinearDynamicalSystemのインスタンスであると仮定します

# `y`はサイズ(num*features, num*time_steps)の観測行列です

# `FB`は事前に初期化されたForwardBackwardオブジェクトです

# `FS`は各レジームのためのFilterSmoothオブジェクトの配列です

elbo = variational_expectation!(model, y, FB, FS) println("計算されたELBO: ", elbo)
```
