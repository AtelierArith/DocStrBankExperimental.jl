equalisecolourmap/equalizecolormap - カラーマップの色のコントラストを均一化する

この関数はcmap()によって使用され、通常はこの関数を直接呼び出すことはありません。ただし、他のソースから取得したカラーマップの知覚コントラストを均一化するためにこの関数を使用してみることができます。

```
Usage: newrgbmap = equalisecolourmap(rgblab, map, formula, W, sigma, diagnostics)
                   equalizecolormap(....

Arguments:     rgblab - データのタイプを示す文字列 "RGB" または "LAB"
                        map.
                  map - Nx3 RGBまたはCIELABカラーマップ
                        またはColorTypes.RGBA{Float64}値の配列
              formula - 文字列 "CIE76" または "CIEDE2000"
                    W - 明度、クロマ、色相成分に適用される
                        差分方程式の重みの3ベクトル。明度のみを考慮するには
                        [1, 0, 0]を使用することをお勧めします。
                        必要に応じて、完全な式のために[1, 1, 1]を使用します。
                        下記の注釈を参照してください。
                sigma - オプションのガウス平滑化パラメータ、詳細は
                        下記の説明を参照してください。
               cyclic - カラーマップが循環しているかどうかを示すブールフラグ。
                        これはエンドポイントでの平滑化の適用方法に影響します。
          diagnostics - 診断プロットを表示するかどうかを示すオプションのブールフラグ。
                        デフォルトはfalseです。

Returns:    newrgbmap - カラーマップに沿った色の知覚コントラストが一定になるように調整されたRGBカラーマップ。
                        これはNx3のFloat64値の配列です。
```

推奨パラメータ:

CIE76およびCIEDE2000の色差式は、通常私たちが関心を持つよりもはるかに低い空間周波数のために開発されました。どちらも私たちのアプリケーションには理想的ではありません。主な点は、*細かい*空間周波数では、知覚コントラストは*明度*の違いによって支配され、クロマと色相は相対的に重要ではないということです。

明度の範囲が大きいカラーマップには次のように使用します:

```
                       formula = "CIE76" または "CIEDE2000"
                             W = [1, 0, 0]  (明度のみを修正)
                         sigma = 5 - 7
```

等輝度または低明度勾配のカラーマップには次のように使用します:

```
                       formula = "CIE76"
                             W = [1, 1, 1]  (色と明度を修正)
                         sigma = 5 - 7
```

理想的には、カラーマップが効果的であるためには、カラーマップに沿った知覚コントラストが一定であるべきです。多くのカラーマップはこの点で非常に劣っています。お気に入りのカラーマップをsineramp()テスト画像でテストしてみてください。知覚コントラストは、カラーマップに沿った色の明度値のコントラストによって非常に支配されています。この関数は、カラーマップのセクションを引き伸ばしたり圧縮したりすることによって、選択した知覚コントラストの測定値をカラーマップに沿って均一化しようとします。

この関数の主な用途はcmap()によって生成されたカラーマップの修正ですが、任意のカラーマップに適用できます。この関数が修正できることには限界があります。MATLABのカラーマップのいくつか（'jet'、'hsv'、'cool'など）に適用すると、これらのカラーマップには明度がほぼ一定のセグメントがあるため、色の不連続性アーティファクトが発生します。しかし、MATLABの'熱'、'冬'、'春'、'秋'のカラーマップを修正するのにはうまく機能します。結果のカラーマップに色の不連続性が見られる場合は、Wを[1, 0, 0]から[1, 1, 1]に変更するか、[1, 0.5, 0.5]のような中間の重み付けに変更してみてください。

差分式: CIE76またはCIEDE2000の差分測定は、私たちが関心を持つ高い空間周波数には理想的ではありません。経験的に、CIEDE2000は明度勾配が大きいカラーマップ（ほとんどのカラーマップに適用されます）でわずかに良い結果を出すようです。この場合、重みベクトルW = [1, 0, 0]を使用します。等輝度または低明度勾配のカラーマップで重みベクトルW = [1, 1, 1]を使用する場合、CIE76を使用する必要があります。CIEDE2000のクロマ補正は、私たちが関心を持つ空間周波数には不適切です。

重みベクトルW: CIEDE2000の色差式は、明度、クロマ、色相の差分成分の分母にスケーリングパラメータkL、kC、kHを組み込んでいます。Wの3つの成分は、これらの3つのパラメータの逆数に対応します。（なぜ彼らがkL、kC、kHを分母に置くことにしたのかはわかりません。たとえば、クロマ成分を無視したい場合は、W[2]を0に設定するのではなく、kCをInfに設定する必要があります。私にはより理にかなっているように思えます）。CIE76を使用している場合、W[2]とW[3]はaおよびbの差に適用されます。この場合、W[2] = W[3]であることを確認する必要があります。一般的に、私たちが関心を持つ空間周波数に対して、明度の違いはクロマや色相よりも圧倒的に重要であり、Wは[1, 0, 0]に設定する必要があります。

平滑化パラメータsigma: 出力カラーマップは、一定の傾斜の明度値を持ちます。ただし、傾斜の符号が変わる可能性があり、たとえば、双方向カラーマップの中間点でそうなることがあります。この明度の傾斜の不連続性は、カラーマップに偽の明らかな特徴を引き起こす可能性があります。aおよびbの傾斜の不連続性でも小さな影響が発生します。このようなカラーマップでは、Lab値のわずかな平滑化を導入して、傾斜の符号の遷移を柔らかくし、この明らかな特徴を取り除くことが有用です。ただし、これを行うと、カラーマップ内に明度コントラストが抑制された小さな領域が作成され、データ範囲に特徴が存在する場合にその可視性が損なわれる「盲点」が生じます。したがって、平滑化は最小限に抑えるべきです。256要素のカラーマップでは、5から7の範囲のsigmaの値が適切なようです。ガイドラインとして、sigmaはカラーマップのエントリ数の約1/25を超えないようにし、できればそれ以下にするべきです。

参考文献: Peter Kovesi. 良いカラーマップ: それらを設計する方法。 [arXiv:1509.03700 [cs.GR] 2015](https://arXiv:1509.03700)

関連項目: cmap, applycycliccolourmap, applydivergingcolourmap, sineramp, circlesineramp
