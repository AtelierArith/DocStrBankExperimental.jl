prepare the shared data with or without serialization
