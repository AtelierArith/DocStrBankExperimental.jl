```
interactive_trajectory_timeseries(ds::DynamicalSystem, fs, [, u0s]; kwargs...) → fig, dsobs
```

`ds`の軌道と観測可能量の時系列を視覚化するためのMakie `Figure`を作成します。この`Figure`は、パラメータと時間の進化に対するインタラクティブな制御を可能にするインタラクティブなGUIとしても使用できます。また、ビデオやカスタマイズされたアニメーションを作成するためにも使用できます。詳細は以下を参照してください。

`fs`は「観測するインデックス」の`Vector`であり、すなわち[`observe_state`](@ref)に渡すことができるものです。各観測インデックスは時系列プロットを生成します。`u0s`は初期条件の`Vector`です。各初期条件はユニークな色で進化し、状態空間の軌道と観測された時系列の両方として表示されます。`u0`の要素は、完全な状態をエンコードする`Vector{Real}`または`ds`の現在の状態から部分的に状態を設定するための`Dict`であることができます（[`set_state!`](@ref)と同様）。

`u0s`の初期条件からの軌道はすべて並行して進化し、視覚化されます。デフォルトでは、システムの現在の状態のみが使用されます。`u0s`は[`ParallelDynamicalSystem`](@ref)によって受け入れられるものであれば何でも構いません。

## 戻り値

`fig, dsobs::DynamicalSystemObservable`を返します。`fig`は作成された`Figure`です。`dsobs`はカスタムアニメーションやインタラクティブなアプリケーションの作成を容易にします。詳細は以下のカスタムアニメーションのセクションを参照してください。

また、[`interactive_trajectory`](@ref)も参照してください。

## インタラクティビティと時間ステップのキーワード

!!! note "GLMakie"
    プロットバックエンドが`GLMakie`または`WGLMakie`の場合、GUI機能が可能です。`using GLMakie; GLMakie.activate!()`を実行して、これが選択されたバックエンドであることを確認してください。


  * `add_controls = true`: `true`の場合、状態空間軸の下に軌道をライブでアニメーション化するためのボタンが追加されます：

      * "reset": 平行な軌道を初期条件に戻します。
      * "run": クリックすると、軌道が時間の中で無限に前進します。再度クリックすると進化が停止します。"run"は単に"step"ボタンを無限に押すだけであり、したがって、画面上で見る視覚的な進行は"steps"スライダーの値に依存します。したがって、アニメーションが"実行"されている間に、"steps"スライダーを増減させてアニメーション速度を増減させることができます。連続時間システムのスムーズなアニメーションには、小さな`Δt`と大きな`tail`が必要です。
      * "step": クリックすると、"steps"スライダーの右側で選択されたステップ数だけ軌道を時間の中で前進させます。各ステップは`Δt`の単位時間の進化です（"step"ボタンをクリックすると、スライダーに応じて1回以上のステップが実行される場合があります）。

    プロットされた軌道は、以下で説明するカスタムアニメーションセットアップを使用して常に手動で進化させることができます。`add_controls`は、作成された図に追加されたボタンとインタラクティビティにのみ関係します。
  * `parameter_sliders = nothing`: 与えられた場合、辞書でなければなりません。パラメータインデックス（[`set_parameter!`](@ref)に渡すことができる有効なインデックス）をパラメータ値の範囲にマッピングします。インデックスと範囲の各組み合わせは、時間の進化中にシステムパラメータをインタラクティブに制御するためのスライダーになります。パラメータスライダーの下に、GUI使用のために3つのボタンが追加されます：

      * "update": クリックすると、選択されたパラメータ値がシステムに伝播されます。
      * "u.r.s.": クリックすると、"update"、"reset"、"step"の順にクリックするのと同じです。
      * "reset p": クリックすると、パラメータが初期値にリセットされます。

    パラメータは、以下で説明するカスタムアニメーションセットアップを使用しても変更できます。`parameter_sliders`は、作成された図に追加されたボタンとインタラクティビティにのみ関係します。
  * `parameter_names = Dict(keys(ps) .=> string.(keys(ps)))`: パラメータキーをラベルにマッピングする辞書。`parameter_sliders`が与えられた場合のみ使用されます。
  * `Δt`: 時間進化の時間ステップ。離散時間の場合はデフォルトで1、連続時間システムの場合は0.01です。連続時間の動的システムは、正確に`Δt`時間（`step!`への第3引数は`true`）でステップされます。
  * `pause = nothing`: 与えられた場合、実数でなければなりません。この数は、各プロット更新の間に呼び出される`sleep`関数に渡されます。時間積分が計算的に安価で、アニメーションが速すぎる場合に便利です。
  * `starting_step = 1`: "step"スライダーの開始値。

## 視覚化キーワード

  * `colors`: 各初期条件（および結果の軌道と時系列）の色。`u0s`と同じ長さの`Vector`である必要があります。
  * `tail = 1000`: プロットされた軌道の長さ（`Δt`の単位）。
  * `fade = 0.5`: 状態空間の軌道は完全な透明度に向かってフェードします。アルファチャネル（透明度）は`t^fade`としてスケールし、`t`は0から1まで変化します（1は軌道の終わり）。線形フェードには`fade = 1.0`を、フェードなしには`fade = 0`を使用します。現在のデフォルトは、軌道の開始時にフェードが速く、終了時に遅く進行します。
  * `markersize = 15`: 軌道の端点のマーカーのサイズ。離散システムの場合、その半分が軌道の尾に使用されます。
  * `plotkwargs = NamedTuple()`: 状態空間プロットに伝播されるキーワード引数の名前付きタプル（連続の場合は`lines`、離散システムの場合は`scatter`）。`plotkwargs`は名前付きタプルのベクターでもあり、その場合、各初期条件には異なる引数が与えられます。

## 状態空間軌道キーワード

  * `idxs = 1:min(length(u0s[1]), 3)`: 状態空間軌道にプロットする変数。[`observe_state`](@ref)に渡すことができる任意のインデックスをここに渡すことができます。
  * `statespace_axis = true`: 軌道プロットのための軸を作成して表示するかどうか。
  * `idxs = 1:min(length(u0s[1]), 3)`: 状態空間軌道にプロットする変数。[`observe_state`](@ref)に渡すことができる任意のインデックスをここに渡すことができます。3つのインデックスが与えられた場合、軌道プロットは3Dになります。それ以外の場合は2Dです。
  * `lims`: 軸の制限のためのタプルのタプル（最小、最大）。与えられない場合、各`u0s`を1000 `Δt`単位進化させて最も極端な値を選択することによって自動的に推測されます（ライブアニメーション中に制限はデフォルトで調整されません）。
  * `figure, axis`: 両方とも、`Figure`と状態空間`Axis`インスタンスの生成に伝播される任意のキーワードを持つ名前付きタプルであることができます。

## 時系列キーワード

  * `linekwargs = NamedTuple()`: 時系列プロットに伝播される追加のキーワード。各ユニークな初期条件ごとに名前付きタプルのベクターでも構いません。
  * `timeseries_names`: 時系列プロットのyラベルに名前を付けるための、長さが`fs`に等しい文字列のベクター。
  * `timeseries_ylims`: 各時系列プロットのy軸の下限と上限のための2タプルのベクター。与えられない場合、`lims`と同様に自動的に推測されます。
  * `timeunit = 1`: 時間の単位（あれば）。時系列のx軸の単位を設定します。
  * `timelabel = "time"`: 時系列プロットのx軸のラベル。

## カスタムアニメーション

2番目の戻り値の引数`dsobs`は`DynamicalSystemObservable`です。メインパネルにプロットされた軌道は、`dsobs`のフィールドである観測可能量にリンクされています。具体的には、フィールド`dsobs.state_obserable`は、各軌道の最終状態を含む観測可能量であり、すなわち`u0s`のようなベクターのベクターです。`dsobs.param_observable`はシステムパラメータの観測可能量です。これらの観測可能量は、インタラクティブなGUIボタンによってトリガーされます（システムが時間でステップされるときの最初の2つ、パラメータが更新されるときの最後の1つ）。ただし、これらの観測可能量、したがってこれらの観測可能量から`map`された対応するプロットされた軌道は、`DynamicalSystem`の正式なAPIを介して更新できます：

```
step!(dsobs, n::Int = 1)
```

は、`n`ステップの`Δt`時間でシステムをステップし、最後のステップでのみプロットを更新します。`set_parameter!(dsobs, index, value)`はシステムパラメータを更新し、その後パラメータ観測可能量をトリガーします。最後に、`set_state!(dsobs, new_u [, i])`は`i`-thシステム状態を設定し、軌道プロットを新しい初期条件にクリアします。

この情報は、カスタムアニメーションやインタラクティブアプリを作成するために使用できます。原則として、ユーザーが行うべき唯一のことは、既存の観測可能量から新しい観測可能量を作成し、例えば`on`関数を使用してこれらの新しい観測可能量をプロットすることです。さまざまな例がオンラインドキュメントに提供されています。 ```
