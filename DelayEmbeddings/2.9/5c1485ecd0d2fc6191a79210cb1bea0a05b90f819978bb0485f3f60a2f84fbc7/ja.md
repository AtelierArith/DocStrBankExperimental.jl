```
pecuzal_embedding(s; kwargs...) → Y, τ_vals, ts_vals, ΔLs, ⟨ε★⟩
```

最近のKraemerらによるPECUZALアルゴリズムに基づいて、時系列または時系列のセット（`StateSpaceSet`）を適切に埋め込むための統一アプローチです[^Kraemer2021]。

詳細については、以下の説明を参照してください。

## キーワード引数

  * `τs = 0:50`: 可能な遅延値 `τs`（サンプリング時間単位）。各 `τs` に対して、連続性統計 ⟨ε★⟩ が計算され、各埋め込みサイクル `i` の最適遅延 `τᵢ` を見つけるためにさらに処理されます。
  * `w::Int = 0`: タイムインデックス `w` に近い点の隣接点（真の隣接点から除外される）。`w=0` は、点自体のみを除外し、時間的隣接点は除外しないことを意味します。
  * `samplesize::Real = 1.0`: 平均を取るために考慮される状態空間点の割合（基準点 v）で、⟨ε★⟩ を生成します。割合が低いほど、精度と計算時間が低下します。
  * `K::Int = 13`: δ-ボール内の最近傍点の数（アルゴリズムの説明を参照）。有効な統計を保証するためには、少なくとも8である必要があります。⟨ε★⟩ は、すべての `k ∈ K` の最小結果を取って計算されます。
  * `KNN::Int = 3`: σ*k^2 を計算するために考慮される最近傍点の数（アルゴリズムの説明 [`uzal*cost`]@ref を参照）。ベクトルが与えられた場合、すべての`knn ∈ KNN` の最小結果が返されます。
  * `L_threshold::Real = 0`: この閾値を超えた場合、アルゴリズムは埋め込みサイクルで中断します（正の数、すなわち `ΔL` の絶対値として設定）。
  * `α::Real = 0.05`: 連続性統計を取得するための有意水準
  * `p::Real = 0.5`: 連続性統計 ⟨ε★⟩ の計算に使用される二項分布の p-パラメータ。
  * `max_cycles = 50`: アルゴリズムは、そのサイクル数の後に停止します。
  * `econ::Bool = false`: L統計計算のための経済モード。時間の地平線 `2:Tw` に対して L統計を計算する代わりに、ここでは `2:2:Tw` のみを計算します。詳細については説明を参照してください。
  * `verbose = true`: プロセスに関する情報を印刷します。

## 説明

このメソッドは反復的に動作し、最終的な埋め込みベクトル `Y` を徐々に構築します。`⟨ε★⟩`-統計（[`pecora`](@ref) の）に基づいて、アルゴリズムは各埋め込みサイクル `i` の最適遅延値 `τᵢ` を選択します。それを達成するために、入力された時系列 `s` を実際の位相空間軌道 `Y_actual` として示し、連続性統計 `⟨ε★⟩` を計算します。

1. `⟨ε★⟩` の各局所最大値は、その特定のピークに対応する遅延を持つ候補埋め込み軌道 `Y_trial` を構築するために使用されます。
2. 次に、`Y_trial`（`L-trial`）と `Y_actual`（`L_actual`）のために、予測時間の地平線を増加させながら `L`-統計（[`uzal_cost`](@ref) の）を計算し、最大の差 `max(L-trial - L_actual)` を `ΔL` として保存します（これは負の数であることに注意してください。なぜなら、`L`-統計はより良い再構成に伴って減少するからです）。
3. `ΔL` が最小（全体の `L`-値の最大減少）となる `τ`-値を選択し、実際の埋め込み軌道 `Y_actual` を構築します（ステップ 1.-3. は埋め込みサイクルに対応します）。
4. ステップ 1.-3. を `Y_actual` を入力として繰り返し、`ΔL` が 0 より大きいとき、すなわち追加の埋め込み成分が全体の L-値を低下させない場合にアルゴリズムを停止します。 `Y_actual` -> `Y`。

多変量埋め込みの場合、すなわち M 個の時系列（`s::StateSpaceSet`）を埋め込む場合、各埋め込みサイクルで連続性統計 `⟨ε★⟩` が利用可能なすべての M 個の時系列に対して計算されます。各埋め込みサイクルでの最適遅延値 `τ` は、すべての利用可能なピークとすべての M の `⟨ε★⟩` の下で `ΔL` が最小となるピーク/`τ`-値として選択されます。最初の埋め込みサイクルでは、考慮すべき `⟨ε★⟩` が M² 番号異なることになります。なぜなら、入力のどの時系列が埋め込みベクトルの最初の成分を構成し、`Y_actual` を形成するかは事前に明確ではないからです。

考慮される遅延値の範囲は `τs` で決定され、最近傍検索では Theiler ウィンドウ `w` を尊重します。最終的な埋め込みベクトルは `Y`（`StateSpaceSet`）に保存されます。各埋め込みサイクルのために選択された遅延値は `τ_vals` に保存され、各遅延値に対して選択された時系列番号は `ts_vals` に保存されます。単変量埋め込み（`s::Vector`）の場合、`ts_vals` は `τ_vals` の長さの 1 のベクトルであり、選択する時系列は単に 1 つだけです。この関数は、各埋め込みサイクルのための `ΔLs`-値と、連続性統計 `⟨ε★⟩` を `Vector` の `Array` として返します。

距離計算にはユークリッドノルムが使用されます。

[^Kraemer2021]: Kraemer, K.H., Datseris, G., Kurths, J., Kiss, I.Z., Ocampo-Espindola, Marwan, N. (2021) [A unified and automated approach to attractor reconstruction. New Journal of Physics 23(3), 033017](https://iopscience.iop.org/article/10.1088/1367-2630/abe336).
