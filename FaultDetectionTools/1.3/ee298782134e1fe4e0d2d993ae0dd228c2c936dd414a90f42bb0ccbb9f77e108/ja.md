```
efdisyn(sysf::FDIModel, SFDI; rdim, nullspace = true, simple = false, minimal = true, separate = false,
                       sdeg, smarg, poles, HDesign, FDtol, FDGainTol, FDfreq, 
                       tcond, offset, atol, atol1, atol2, atol3, rtol, fast = true) 
                       -> (Q::FDFilter, R::FDFilterIF, info)
```

与えられた合成モデル `sysf` と加法故障および与えられたバイナリ構造行列 `SFDI`（仕様）に対して、*正確な故障検出および隔離問題*（EFDIP）を解決します。計算された安定で適切なフィルタオブジェクト `Q` と `R` は、EFDIP の解を表す故障検出および隔離フィルタを含み、それぞれ内部形式を表します。

返される名前付きタプル `info` は、コンポーネント `info.tcond`、`info.degs`、および `info.HDesign` を含み、追加の合成関連情報を含みます（以下を参照）。

連続時間または離散時間システム `sysf.sys` は、標準または記述子状態空間形式 `sysf.sys = (A-λE,B,C,D)` にあり、これは入力-出力形式に対応します。

```
   y = Gu(λ)*u + Gd(λ)*d + Gf(λ)*f + Gw(λ)*w + Ga(λ)*aux,
```

ラプラス変換または Z 変換されたプラント出力 `y`、制御入力 `u`、外乱入力 `d`、故障入力 `f`、ノイズ入力 `w`、および補助入力 `aux` があり、`Gu(λ)`、`Gd(λ)`、`Gf(λ)`、`Gw(λ)`、および `Ga(λ)` はそれぞれの伝達関数行列です。制御、外乱、故障、ノイズ、および補助入力のインデックスは、関連する整数ベクトル `sysf.controls`、`sysf.disturbances`、`sysf.faults`、`sysf.noise`、および `sysf.aux` に含まれています。

故障検出および隔離フィルタオブジェクト `Q` は、`Q.sys` に `nb` フィルタのバンクを含みます。`i` 番目のフィルタ `Q.sys[i]` は標準状態空間形式であり、全体の残差ベクトル `r := [r_1; r_2; ...; r_nb]` の `i` 番目の成分（スカラーまたはベクトル） `r_i` を生成します。`i` 番目のフィルタの対応する入力-出力（実装）形式は次のようになります。

```
        r_i = Qyi(λ)*y + Qui(λ)*u   ,
```

ここで、`Qyi(λ)` と `Qui(λ)` は出力および制御入力から `i` 番目の残差成分への伝達関数行列です。出力および制御入力のインデックスは、整数ベクトル `Q.outputs` と `Q.controls` に含まれています。

内部形式オブジェクト `R` の故障検出および隔離フィルタは、`R.sys` に `nb` のフィルタの内部形式のバンクを含みます。`i` 番目のフィルタ `R.sys[i]` は標準状態空間形式であり、残差信号 `r_i` を生成し、入力-出力形式に対応します。

```
   r_i = Rui(λ)*u + Rdi(λ)*d + Rfi(λ)*f + Rwi(λ)*w + Rai(λ)*aux ,
```

ここで、

```
   | Rui(λ) Rdi(λ) Rfi(λ) Rwi(λ) Rai(λ) | := |Qyi(λ) Qui(λ)]*| Gu(λ) Gd(λ) Gf(λ) Gw(λ) Ga(λ) |. 
                                                             |   I     0     0     0     0   |
```

EFDIP の解は、`i` 番目のフィルタに対して `Rui(λ) = 0`、`Rdi(λ) = 0`、および `Rfi(λ)` の `j` 番目の列が非ゼロであることを保証します。これは、`SFDI` の `(i,j)` 番目の要素が非ゼロである場合です。結果として得られるフィルタ `R.sys` の入力 `u`、`d`、`f`、`w` および `aux` のインデックスは、それぞれ整数ベクトル `R.controls`（無効）、`R.disturbances`（無効）、`R.faults`、`R.noise` および `R.aux` に含まれています。

結果として得られるコンポーネントフィルタ `Q.sys[i]` と `R.sys[i]` は、可観測な状態空間実現 `(AQi,BQi,CQi,DQi)` と `(AQi,BRi,CQi,DRi)` を持ち、したがって可観測なペア `(AQi,CQi)` を共有します。

さまざまなユーザーオプションは、キーワード引数を介して次のように指定できます。

`minimal = true`（デフォルト）の場合、最小次数フィルタ合成が行われ、`Q.sys[i]` および `R.sys[i]` の各コンポーネントフィルタが決定されます。一方、`minimal = false` の場合は、フルオーダー合成が行われます。

`HDesign = H` の場合、`H` はフル行ランクまたは空の設計行列 `H = [H_1, ..., H_nb]` の `nb` 次元配列であり、`H_i` は `i` 番目のコンポーネントフィルタの合成に使用される設計行列です（デフォルト：`HDesign = missing`）。

`rdim = q` はベクトル `q` を指定し、その `i` 番目の成分 `q[i]` は `Q.sys[i]` および `R.sys[i]` の `i` 番目のコンポーネントフィルタの残差出力の数を指定します。`q` がスカラーの場合、すべての成分が `q` に等しいベクトル `rdim` が仮定されます。`q[i]` のデフォルト値は次のように選択されます：`HDesign = missing` または `H_i` が空である場合、`q[i] = 1`（`minimal = true` の場合）、または `minimal = false` の場合は `Q.sys[i]` および `R.sys[i]` の合成に使用されるヌル空間基底ベクトルの数です。`H_i` がフル行ランク設計行列を指定する場合、`q[i]` は `H_i` の行次元です。

`FDfreq = freq` は、強い検出可能性チェックのための実数周波数値のベクトルまたはスカラー実数周波数値を指定します（デフォルト：`FDfreq = missing`）。

`nullspace = true`（デフォルト）の場合、最小適切なヌル空間基底が初期削減ステップで使用されます。`separate = false` の場合、またはすべての合成ステップで使用されます。`nullspace = false` の場合、初期削減ステップでフルオーダーオブザーバベースのヌル空間基底が使用されます。`separate = true` の場合は、すべての合成ステップで使用されます。このオプションは、外乱入力のない適切なシステムにのみ使用できます。

`simple = true` の場合、単純な適切なヌル空間基底が合成に使用されます。`i` 番目のフィルタの合成に使用される基底ベクトルの次数は `info.deg[i]` に提供されます。`simple = false`（デフォルト）の場合、単純な基底は計算されません。

`separate = false`（デフォルト）の場合、最小適切なヌル空間基底が初期削減ステップで使用される二段階合成手順が採用されます。`separate = true` の場合、フィルタコンポーネントは適切に定式化された故障検出問題を解くことによって別々に決定されます。

`offset = β` は、極の安定性を評価するための境界オフセット `β` を指定します。したがって、連続時間システムの安定性のためには、すべての極の実部が最大で `-β` でなければならず、離散時間システムの安定性のためには、すべての極の絶対値が最大で `1-β` でなければなりません。`β` に使用されるデフォルト値は `sqrt(ϵ)` であり、ここで `ϵ` は作業機械精度です。

`smarg = α` は、極の安定性領域 `Cs` を定義する安定性マージンを指定します。連続時間システムの場合、`Cs` は実部が最大で `α` の複素数の集合であり、離散時間システムの場合、`Cs` は絶対値が最大で `α < 1` の複素数の集合です（すなわち、原点を中心とした半径 `α` の円の内部）。`smarg` が欠落している場合、使用されるデフォルト値は、連続時間システムの場合は `α = -β`、離散時間システムの場合は `α = 1-β` です。ここで、`β` はキーワード引数 `offset = β` によって指定された境界オフセットです。

`sdeg = γ` は、フィルタ `Q` および `R` の極に対する指定された安定性次数です（デフォルト：連続時間システムの極の実部に対して `γ = -0.05`、離散時間システムの極の絶対値に対して `γ = 0.95`）。

`poles = v` は、フィルタ `Q` および `R` に割り当てる安定性領域 `Cs` 内の望ましい極の複素共役セットを含む複素ベクトル `v` を指定します（デフォルト：`poles = missing`）。

`tcond = tcmax` は、使用される非直交変換の最大許容条件数 `tcmax` を指定します（デフォルト：`tcmax = 1.e4`）。

`FDtol = tol1` は、故障検出可能性チェックのためのしきい値 `tol1` を指定します（デフォルト：`tol1 = 0.0001`）。

`FDGainTol = tol2` は、強い故障検出可能性チェックのためのしきい値 `tol2` を指定します（デフォルト：`tol2 = 0.01`）。

実施された削減におけるランクの決定は、`fast = true` の場合は列ピボットを伴うランクを明らかにする QR 分解に基づいており、`fast = false` の場合はより信頼性の高い SVD 分解に基づいています。

キーワード引数 `atol1`、`atol2`、および `rtol` は、それぞれ `A`、`B`、`C`、`D` の非ゼロ要素の絶対許容誤差、`E` の非ゼロ要素の絶対許容誤差、および `A`、`B`、`C`、`D` および `E` の非ゼロ要素の相対許容誤差を指定します。デフォルトの相対許容誤差は `n*ϵ` であり、ここで `ϵ` は作業機械エプシロンで、`n` はシステム `sysf.sys` の次数です。キーワード引数 `atol3` は可観測性テストのための絶対許容誤差です（デフォルト：内部で決定された値）。キーワード引数 `atol` は、同時に `atol1 = atol`、`atol2 = atol` および `atol3 = atol` を設定するために使用できます。

結果として得られる名前付きタプル `info` は `(tcond, degs, HDesign)` を含みます。ここで：

`info.tcond` は `nb` 次元ベクトルであり、その `i` 番目の成分は、`i` 番目のフィルタコンポーネントの合成に使用される非直交変換行列の条件数の最大値です。`info.tcond[i] >= tcmax` の場合は警告が発行されます。

`info.degs` は `nb` 次元ベクトルであり、その `i` 番目の成分は、`simple = true` の場合は `i` 番目のフィルタコンポーネントの合成に使用される単純なヌル空間基底の基底ベクトルの次数を含む整数ベクトルであり、`simple = false` の場合は同等の多項式ヌル空間基底の基底ベクトルの次数を含みます。

`info.HDesign` は `nb` 次元ベクトルであり、その `i` 番目の成分は、`i` 番目の故障検出フィルタの合成に使用される設計行列 `H_i` です。

*メソッド:* 正確な故障検出および隔離問題を解決するために、手続き EFDI が実装されています。この手続きは、[2] で提案されたヌル空間ベースの合成方法に依存しています。故障検出フィルタの最小次数合成の詳細については、[3] を参照してください。

*参考文献:*

[1] A. Varga, Solving Fault Diagnosis Problems - Linear Synthesis Techniques.                Springer Verlag, 2017; sec. 5.4.

[2] A. Varga,  On designing least order residual generators for fault detection      and isolation. 16th International Conference on Control Systems and       Computer Science, Bucharest, Romania, 2007.

[3] A. Varga, On computing least order fault detectors using rational nullspace bases.      IFAC SAFEPROCESS'03 Symposium, Washington DC, USA, 2003. ```
