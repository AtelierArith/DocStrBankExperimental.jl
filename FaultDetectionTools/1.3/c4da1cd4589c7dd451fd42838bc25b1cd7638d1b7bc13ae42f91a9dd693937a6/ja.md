```
afdisyn(sysf::FDIModel, SFDI; rdim, nullspace = true, simple = false, minimal = true, separate = false,
                       gamma = 1, epsreg = 0.1, sdegzer, nonstd = 1, freq, sdeg, smarg, poles, 
                       HDesign, HDesign2, scale2, FDtol, FDGainTol, FDfreq, 
                       tcond, offset, atol, atol1, atol2, atol3, rtol, fast = true) 
                       -> (Q::FDFilter, R::FDFilterIF, info)
```

与えられた合成モデル `sysf` と加法故障を持つ与えられたバイナリ構造行列 `SFDI` を用いて、*近似故障検出および隔離問題* (AFDIP) を解決します。計算された安定かつ適切なフィルタオブジェクト `Q` と `R` は、故障検出および隔離フィルタを含み、AFDIP の解を表し、その内部形式をそれぞれ表します。

返される名前付きタプル `info` には、`info.tcond`、`info.degs`、`info.degs2`、`info.HDesign`、`info.HDesign2` および `info.gap` のコンポーネントが含まれ、追加の合成関連情報が含まれています（以下を参照）。

連続時間または離散時間システム `sysf.sys` は、標準または記述子状態空間形式 `sysf.sys = (A-λE,B,C,D)` にあり、これは入力-出力形式に対応します。

```
   y = Gu(λ)*u + Gd(λ)*d + Gf(λ)*f + Gw(λ)*w + Ga(λ)*aux,
```

ラプラス変換または Z 変換されたプラント出力 `y`、制御入力 `u`、外乱入力 `d`、故障入力 `f`、ノイズ入力 `w` および補助入力 `aux` があり、`Gu(λ)`、`Gd(λ)`、`Gf(λ)`、`Gw(λ)` および `Ga(λ)` はそれぞれの伝達関数行列です。制御、外乱、故障、ノイズおよび補助入力のインデックスは、関連する整数ベクトル `sysf.controls`、`sysf.disturbances`、`sysf.faults`、`sysf.noise` および `sysf.aux` に含まれています。

故障検出および隔離フィルタオブジェクト `Q` は、`Q.sys` に `nb` フィルタのバンクを含みます。`i` 番目のフィルタ `Q.sys[i]` は標準状態空間形式であり、全体の残差ベクトル `r := [r_1; r_2; ...; r_nb]` の `i` 番目の成分（スカラーまたはベクトル） `r_i` を生成します。`i` 番目のフィルタの対応する入力-出力（実装）形式は次のようになります。

```
        r_i = Qyi(λ)*y + Qui(λ)*u   ,
```

ここで `Qyi(λ)` と `Qui(λ)` は出力および制御入力から `i` 番目の残差成分への伝達関数行列です。出力および制御入力のインデックスは、整数ベクトル `Q.outputs` および `Q.controls` に含まれています。

内部形式オブジェクト `R` の故障検出および隔離フィルタは、`R.sys` に `nb` のフィルタの内部形式のバンクを含みます。`i` 番目のフィルタ `R.sys[i]` は標準状態空間形式であり、残差信号 `r_i` を生成し、入力-出力形式に対応します。

```
   r_i = Rui(λ)*u + Rdi(λ)*d + Rfi(λ)*f + Rwi(λ)*w + Rai(λ)*aux ,
```

ここで 

```
   | Rui(λ) Rdi(λ) Rfi(λ) Rwi(λ) Rai(λ) | := |Qyi(λ) Qui(λ)]*| Gu(λ) Gd(λ) Gf(λ) Gw(λ) Ga(λ) |. 
                                                             |   I     0     0     0     0   |
```

AFDIP の解は、`i` 番目のフィルタに対して `Rui(λ) = 0`、`Rdi(λ) = 0`、`Rfi(λ)` の `j` 番目の列が `SFDI` の `(i,j)` 番目の要素が非ゼロの場合に非ゼロであり、`Rwi(λ)` の H∞-ノルムが `||Rwi(λ)||∞ < γ` を満たすことを保証します。ここで、上限 `γ` はキーワード引数 `gamma` を介して指定されます。結果として得られるフィルタ `R.sys` の入力 `u`、`d`、`f`、`w` および `aux` のインデックスは、それぞれ整数ベクトル `R.controls`（無効）、`R.disturbances`（無効）、`R.faults`、`R.noise` および `R.aux` に含まれています。

伝達関数行列 `Qi(λ) := [ Qyi(λ) Qui(λ) ]` および `Ri(λ) := [ Rui(λ) Rdi(λ) Rfi(λ) Rwi(λ) Rai(λ) ]` の `i` 番目の成分は、一般に次のような分割形式を持ちます。

```
 Qi(λ) = [ Q1i(λ) ] ,   Ri(λ) = [ R1i(λ) ] ,                      (1)
         [ Q2i(λ) ]             [ R2i(λ) ]
```

フィルタ `Q1i(λ)` および `R1i(λ)` は AFDP の解であり、`Q2i(λ)` および `R2i(λ)` は残差から制御および外乱入力をデカップリングすることによって得られた縮小システムに対して定式化された正確な故障検出問題の解です（[4]を参照）。全体の結果として得られる成分フィルタ `Q.sys[i]` および `R.sys[i]` は、観測可能な状態空間実現 `(AQi,BQi,CQi,DQi)` および `(AQi,BRi,CQi,DRi)` を持ち、したがって観測可能なペア `(AQi,CQi)` を共有します。

さまざまなユーザーオプションは、キーワード引数を介して次のように指定できます。

`minimal = true`（デフォルト）の場合、最小次数フィルタ合成が行われ、`i = 1, ...,nb` の各コンポーネントフィルタ `Q.sys[i]` および `R.sys[i]` が決定されます。一方、`minimal = false` の場合はフルオーダー合成が行われます。

`exact = true` の場合、正確な合成（最適化なし）が行われますが、`exact = false`（デフォルト）の場合は近似合成が行われます。

`HDesign = H1` の場合、`H1` はフル行ランクまたは空の設計行列の `nb` 次元配列であり、`H1[i]` は `i` 番目のフィルタの `(1)` におけるコンポーネント `Q1i(λ)` および `R1i(λ)` の合成に使用される設計行列です（デフォルト: `HDesign = missing`）。

`HDesign2 = H2` の場合、`H2` はフル行ランクまたは空の設計行列の `nb` 次元配列であり、`H2[i]` は `i` 番目のフィルタの `(1)` におけるコンポーネント `Q2i(λ)` および `R2i(λ)` の合成に使用される設計行列です（デフォルト: `HDesign2 = missing`）。

`rdim = q` はベクトル `q` を指定し、その `i` 番目の成分 `q[i]` は `Q.sys[i]` および `R.sys[i]` の `i` 番目のコンポーネントフィルタの残差出力の数を指定します。`q` がスカラーの場合、すべての成分が `q` に等しいベクトル `rdim` が仮定されます。`rdim = missing` の場合、デフォルト値 `q[i]` は `q[i] = q1i + q2i` として選択され、デフォルト値 `q1i` および `q2i` は縮小システムにおける `Rwi(λ)` のランク `rwi` を考慮して選択されます（[2]を参照）。`HDesign = missing` の場合、`minimal = true` の場合は `q1i = min(1,rwi)`、`minimal = false` の場合は `q1i = rwi` となります。`HDesign = H1` の場合、`q1i` は非空の設計行列 `H1[i]` の行次元であり、`H1[i]` が空である場合は、`HDesign = missing` の場合の選択が適用されます。`HDesign2 = missing` の場合、`minimal = true` の場合は `q2i = 1-min(1,rwi)`、`minimal = false` の場合は `q2i` は最大達成可能値に設定されます（[1]を参照）。`HDesign2 = H2` の場合、`q2i` は非空の設計行列 `H2[i]` の行次元であり、`H2[i]` が空である場合は、`HDesign2 = missing` の場合の選択が適用されます。

`FDfreq = freq` は、強い検出可能性チェックのための実数周波数値のベクトルまたはスカラー実数周波数値を指定します（デフォルト: `FDfreq = missing`）。

`nullspace = true`（デフォルト）の場合、最初の削減ステップで最小適切なヌル空間基底が使用され、`separate = false` の場合、またはすべての合成ステップで `separate = true` の場合に使用されます。`nullspace = false` の場合、最初の削減ステップでフルオーダーオブザーバに基づくヌル空間基底が使用され、`separate = false` の場合、またはすべての合成ステップで `separate = true` の場合に使用されます。このオプションは、外乱入力のない適切なシステムにのみ使用できます。

`simple = true` の場合、合成のために単純な適切なヌル空間基底が使用されます。`simple = false`（デフォルト）の場合、単純な基底は計算されません。

`separate = false`（デフォルト）の場合、最初の削減ステップで最小適切なヌル空間基底が使用される2段階の合成手順が採用されます。`separate = true` の場合、フィルタコンポーネントは適切に定式化された故障検出問題を解くことによって別々に決定されます。

`offset = β` は、極の安定性を評価するための境界オフセット `β` を指定します。したがって、連続時間システムの安定性のためには、すべての極の実部が最大で `-β` でなければならず、離散時間システムの安定性のためには、すべての極の絶対値が最大で `1-β` でなければなりません。デフォルト値として使用される `β` は `sqrt(ϵ)` であり、ここで `ϵ` は作業機械精度です。

`smarg = α` は、極の安定性領域 `Cs` を定義する安定性マージンを指定します。連続時間システムの場合、`Cs` は実部が最大で `α` の複素数の集合であり、離散時間システムの場合、`Cs` は絶対値が最大で `α < 1` の複素数の集合です（すなわち、原点を中心とした半径 `α` の円の内部）。`smarg` が欠落している場合、使用されるデフォルト値は、連続時間システムの場合は `α = -β`、離散時間システムの場合は `α = 1-β` です。ここで、`β` はキーワード引数 `offset = β` によって指定された境界オフセットです。

`sdeg = γ` は、フィルタ `Q` および `R` の極に対する指定された安定性度合いを指定します（デフォルト: 連続時間システムの極の実部に対して `γ = -0.05`、離散時間システムの極の絶対値に対して `γ = 0.95`）。

`poles = v` は、フィルタ `Q` および `R` に割り当てる安定性領域 `Cs` 内の望ましい極の複素共役セットを含む複素ベクトル `v` を指定します（デフォルト: `poles = missing`）。

`tcond = tcmax` は、使用される非直交変換の最大許容条件数 `tcmax` を指定します（デフォルト: `tcmax = 1.e4`）。

`FDtol = tol1` は、故障検出可能性チェックのための閾値 `tol1` を指定します（デフォルト: `tol1 = 0.0001`）。

`FDGainTol = tol2` は、強い故障検出可能性チェックのための閾値 `tol2` を指定します（デフォルト: `tol2 = 0.01`）。

`scale2 = σ2` は、`(1)` におけるコンポーネント `Q2i(λ)` および `R2i(λ)` に使用されるスケーリングファクタ `σ2` のベクトルを指定します。すなわち、`Q2i(λ)` および `R2i(λ)` の代わりに `σ2[i]*Q2i(λ)` および `σ2[i]*R2i(λ)` を使用します。（デフォルト: `scale2 = missing` の場合、各 `σ2[i]` は `Q1i(λ)` によって提供される最小ギャップを確保するように選択されます）

`gamma = γ` は、結果として得られる `∥Rwi(λ)∥∞` の許可される上限を指定します（デフォルト: `γ = 1`）。

`epsreg = ϵ` は、[`afdsyn`](@ref) で使用される正則化パラメータ `ϵ` の値を指定します（デフォルト: `ϵ = 0.1`）。

`sdegzer = δ` は、ゼロシフトのための指定された安定性度合い `δ` を指定します（デフォルト: 連続時間システム `sysf.sys` に対して `δ = −0.05`、離散時間システム `sysf.sys` に対して `δ = 0.95`）。

`nonstd = job` は、[`afdsyn`](@ref) での非標準最適化問題を処理するオプションを指定します。次のようになります。

```
  job = 1 – 擬似共外共内因子分解を使用（デフォルト）;
  job = 2 – 正則化パラメータ `ϵ` を使用した修正共外共内因子分解;
  job = 3 – ウィーナーホップ型共外共内因子分解を使用;
  job = 4 – 安定化パラメータ `δ` を使用して非最小位相因子のゼロシフトを行うウィーナーホップ型共外共内因子分解を使用;
  job = 5 – 正則化パラメータ `ϵ` を使用して非最小位相因子の正則化を行うウィーナーホップ型共外共内因子分解を使用。
```

実施された削減におけるランクの決定は、`fast = true` の場合は列ピボットを伴うランクを明らかにする QR 分解に基づいており、`fast = false` の場合はより信頼性の高い SVD 分解に基づいています。

キーワード引数 `atol1`、`atol2`、および `rtol` は、それぞれ `A`、`B`、`C`、`D` の非ゼロ要素の絶対許容誤差、`E` の非ゼロ要素の絶対許容誤差、および `A`、`B`、`C`、`D` および `E` の非ゼロ要素の相対許容誤差を指定します。デフォルトの相対許容誤差は `n*ϵ` であり、ここで `ϵ` は作業機械エプシロンで、`n` はシステム `sysf.sys` の次数です。キーワード引数 `atol3` は可観測性テストの絶対許容誤差です（デフォルト: 内部で決定された値）。キーワード引数 `atol` は、同時に `atol1 = atol`、`atol2 = atol` および `atol3 = atol` を設定するために使用できます。

結果として得られる名前付きタプル `info` には `(tcond, HDesign, HDesign2, freq, gap)` が含まれます。ここで：

`info.tcond` は `nb` 次元ベクトルであり、その `i` 番目の成分は `i` 番目のフィルタコンポーネントの合成に使用される非直交変換行列の条件数の最大値です。`info.tcond[i] >= tcmax` の場合は警告が発行されます。

`info.HDesign = H1` は、`nb` 次元の設計行列のベクトルであり、その `i` 番目の成分 `H1[i]` は `i` 番目の故障検出フィルタの `(1)` におけるコンポーネント `Q1i(λ)` および `R1i(λ)` の合成に使用される設計行列です。

`info.HDesign2 = H2` は、`nb` 次元の設計行列のベクトルであり、その `i` 番目の成分 `H2[i]` は `i` 番目の故障検出フィルタの `(1)` におけるコンポーネント `Q2i(λ)` および `R2i(λ)` の合成に使用される設計行列です。

`info.freq` は、フル行ランクの許容条件をチェックするために使用される周波数値です。

`info.gap` は `nb` 次元ベクトルであり、その `i` 番目の成分は `i` 番目のフィルタコンポーネントの合成のために達成されたギャップです。

*メソッド:* 手続き AFDI は [1] から実装されており、近似故障検出および隔離問題を解決します。実装の詳細については [2] を参照してください。

*参考文献:*

[1] A. Varga, Fault Diagnosis Problems - Linear Synthesis Techniques.                Springer Verlag, 2017; sec. 5.5.

[2] A. Varga, Fault Detection and Isolation Tools (FDITOOLS) User's Guide,                [arXiv:1703.08480](https://arxiv.org/pdf/1703.08480).  ```
