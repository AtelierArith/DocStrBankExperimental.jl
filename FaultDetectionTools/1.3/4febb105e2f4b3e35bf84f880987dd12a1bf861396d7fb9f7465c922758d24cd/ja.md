```
afdsyn(sysf::FDIModel; rdim, nullspace = true, simple = false, minimal = true, exact = false, 
                       gamma = 1, epsreg = 0.1, sdegzer, nonstd = 1, freq, sdeg, smarg, poles, 
                       HDesign, HDesign2, scale2, FDtol, FDGainTol, FDfreq, 
                       tcond, offset, atol, atol1, atol2, atol3, rtol, fast = true) 
                          -> (Q::FDFilter, R::FDFilterIF, info)
```

与えられた合成モデル `sysf` に対して加法故障を持つ近似故障検出問題 (AFDP) を解決します。計算された安定で適切なフィルタオブジェクト `Q` と `R` は、AFDP の解を表す故障検出フィルタを含んでいます。

返される名前付きタプル `info` には、`info.tcond`、`info.degs`、`info.degs2`、`info.S`、`info.S2`、`info.HDesign`、`info.HDesign2`、`info.freq`、および `info.gap` のコンポーネントが含まれており、追加の合成関連情報が含まれています（以下を参照）。

連続時間または離散時間システム `sysf.sys` は、標準または記述子状態空間形式 `sysf.sys = (A-λE,B,C,D)` にあり、これは入力-出力形式に対応します。

```
   y = Gu(λ)*u + Gd(λ)*d + Gf(λ)*f + Gw(λ)*w + Ga(λ)*aux,
```

ラプラス変換または Z 変換されたプラント出力 `y`、制御入力 `u`、外乱入力 `d`、故障入力 `f`、ノイズ入力 `w`、および補助入力 `aux` があり、`Gu(λ)`、`Gd(λ)`、`Gf(λ)`、`Gw(λ)`、および `Ga(λ)` は対応する伝達関数行列です。制御、外乱、故障、ノイズ、および補助入力のインデックスは、それぞれ関連する整数ベクトル `sysf.controls`、`sysf.disturbances`、`sysf.faults`、`sysf.noise`、および `sysf.aux` に含まれています。

故障検出フィルタオブジェクト `Q` は、`Q.sys` に結果として得られたフィルタを標準状態空間形式で含み、残差信号 `r` を生成します。対応する入力-出力（実装）形式は次のとおりです。

```
        r = Qy(λ)*y + Qu(λ)*u  ,
```

ここで `Qy(λ)` と `Qu(λ)` は出力および制御入力から残差への伝達関数行列です。出力および制御入力のインデックスは、それぞれ整数ベクトル `Q.outputs` と `Q.controls` に含まれています。

内部形式の故障検出フィルタオブジェクト `R` は、`R.sys` に結果として得られたフィルタの内部形式を標準状態空間形式で含み、残差信号 `r` を生成し、入力-出力形式に対応します。

```
   r = Ru(λ)*u + Rd(λ)*d + Rf(λ)*f + Rw(λ)*w + Ra(λ)*aux ,
```

ここで 

```
   | Ru(λ) Rd(λ) Rf(λ) Rw(λ) Ra(λ) | = |Qy(λ) Qu(λ)|*| Gu(λ) Gd(λ) Gf(λ) Gw(λ) Ga(λ) |. 
                                                     |  I     0     0     0     0    |
```

AFDP の解は `Ru(λ) = 0`、`Rd(λ) = 0`、`Rf(λ)` のすべての列が非ゼロであり、`Rw(λ)` の H∞-ノルムが `||Rw(λ)||∞ < γ` を満たすことを保証します。ここで、境界 `γ` はキーワード引数 `gamma` を介して指定されます。結果として得られたフィルタ `R.sys` の入力 `u`、`d`、`f`、`w` および `aux` のインデックスは、それぞれ整数ベクトル `R.controls`（無効）、`R.disturbances`（無効）、`R.faults`、`R.noise` および `R.aux` に含まれています。

伝達関数行列 `Q(λ) = [ Qy(λ) Qu(λ) ]` と `R(λ) = [ Ru(λ) Rd(λ) Rf(λ) Rw(λ) Ra(λ) ]` は、一般に、分割形式を持ちます。

```
 Q(λ) = [ Q1(λ) ] ,   R(λ) = [ R1(λ) ] ,                      (1)
        [ Q2(λ) ]            [ R2(λ) ]
```

フィルタ `Q1(λ)` と `R1(λ)` は `q1` 出力を持ち、AFDP の解であり、フィルタ `Q2(λ)` と `R2(λ)` は `q2` 出力を持ち、残差から制御および外乱入力をデカップリングして得られた縮小システムに対して定式化された正確な故障検出問題の解です（[4]を参照）。全体の結果として得られたフィルタ `Q.sys` と `R.sys` は、観測可能な状態空間実現 `(AQ,BQ,CQ,DQ)` と `(AQ,BR,CQ,DR)` を持ち、したがって観測可能なペア `(AQ,CQ)` を共有します。

さまざまなユーザーオプションは、キーワード引数を介して次のように指定できます。

`minimal = true`（デフォルト）の場合、最小次数フィルタ合成が行われますが、`minimal = false` の場合はフルオーダー合成が行われます。

`exact = true` の場合、正確な合成（最適化なし）が行われますが、`exact = false`（デフォルト）の場合は近似合成が行われます。

`HDesign = H1` の場合、フル行ランク `q1` の設計行列 `H1` が使用され、`G1(λ) := [ Gu(λ) Gd(λ); I 0]` の左ヌル空間基底ベクトルの `q1` 線形結合が構築されます。`H1` は、故障検出フィルタのコンポーネント `Q1(λ)` と `R1(λ)` の合成に使用されます（デフォルト: `HDesign = missing`）。

`HDesign2 = H2` の場合、フル行ランク `q2` の設計行列 `H2` が使用され、`G2(λ) := [ Gu(λ) Gd(λ) Gw(λ); I 0 0]` の左ヌル空間基底ベクトルの `q2` 線形結合が構築されます。`H2` は、故障検出フィルタのコンポーネント `Q2(λ)` と `R2(λ)` の合成に使用されます（デフォルト: `HDesign2 = missing`）。

`rdim = q` は、`Q` と `R` の残差出力の希望する数 `q` を指定します。`rdim = missing` の場合、デフォルト値 `q` は `q = q1 + q2` として選択され、デフォルト値 `q1` と `q2` は、縮小システムにおける `Rw(λ)` のランク `rw` を考慮して選択されます（[4]を参照）。`HDesign = missing` の場合、`q1 = min(1,rw)`（`minimal = true` の場合）または `q1 = rw`（`minimal = false` の場合）となります。`HDesign = H` の場合、`q1` は設計行列 `H2` の行次元です。`HDesign2 = missing` の場合、`q2 = 1-min(1,rw)`（`minimal = true` の場合）または `q2 = nvec-rw`（`minimal = false` の場合）となり、ここで `nvec` は初期合成に使用されるヌル空間基底ベクトルの数です（[1]を参照）。`HDesign2 = H2` の場合、`q2` は設計行列 `H2` の行次元です。

`FDfreq = freq` は、強い検出可能性チェックのための実数周波数値のベクトルまたはスカラー実数周波数値を指定します（デフォルト: `FDfreq = missing`）。

`nullspace = true`（デフォルト）の場合、故障検出フィルタの初期合成に最小適切ヌル空間基底が使用されます。`nullspace = false` の場合、フルオーダーオブザーバに基づくヌル空間基底が使用されます。このオプションは、外乱入力のない適切なシステムにのみ使用できます。

`simple = true` の場合、合成に単純な適切ヌル空間基底が使用されます。合成に使用される基底ベクトルの次数は、`info.deg` と `info.deg2` に提供されます（以下を参照）。`simple = false`（デフォルト）の場合、単純な基底は計算されません。

`offset = β` は、極の安定性を評価するための境界オフセット `β` を指定します。したがって、連続時間システムの安定性のためには、すべての極の実部が最大で `-β` でなければならず、離散時間システムの安定性のためには、すべての極の絶対値が最大で `1-β` でなければなりません。`β` に使用されるデフォルト値は `sqrt(ϵ)` であり、ここで `ϵ` は作業機械精度です。

`smarg = α` は、極の安定性領域 `Cs` を定義する安定性マージンを指定します。連続時間システムの場合、`Cs` は実部が最大で `α` の複素数の集合であり、離散時間システムの場合、`Cs` は絶対値が最大で `α < 1` の複素数の集合です（すなわち、原点を中心とした半径 `α` の円の内部）。`smarg` が欠落している場合、使用されるデフォルト値は、連続時間システムの場合 `α = -β`、離散時間システムの場合 `α = 1-β` であり、ここで `β` はキーワード引数 `offset = β` によって指定された境界オフセットです。

`sdeg = γ` は、フィルタ `Q` と `R` の極に対する指定された安定性次数です（デフォルト: 連続時間システムの極の実部に対して `γ = -0.05`、離散時間システムの極の絶対値に対して `γ = 0.95`）。

`poles = v` は、フィルタ `Q` と `R` に割り当てるための安定性領域 `Cs` 内の望ましい極の複素共役セットを含む複素ベクトル `v` を指定します（デフォルト: `poles = missing`）。

`scale2 = σ2` は、(1) のコンポーネント `Q2(λ)` と `R2(λ)` に使用されるスケーリングファクタ `σ2` を指定します。すなわち、`Q2(λ)` と `R2(λ)` の代わりに `σ2*Q2(λ)` と `σ2*R2(λ)` を使用します（デフォルト: `σ2` は `Q1(λ)` によって提供される最小ギャップを確保するために選択されます）。

`freq = val` は、フル行ランク許容条件をチェックするために使用されるテスト周波数の値を指定します（デフォルト: `(0,1)` の範囲でランダムに生成されます）。

`tcond = tcmax` は、使用される非直交変換の最大許容条件数 `tcmax` を指定します（デフォルト: `tcmax = 1.e4`）。

`FDtol = tol1` は、故障検出可能性チェックのための閾値 `tol1` を指定します（デフォルト: `tol1 = 0.0001`）。

`FDGainTol = tol2` は、強い故障検出可能性チェックのための閾値 `tol2` を指定します（デフォルト: `tol2 = 0.01`）。

`gamma = γ` は、`∥Rw(λ)∥∞` の許可される上限を指定します（デフォルト: `γ = 1`）。

`epsreg = ϵ` は、正則化パラメータ `ϵ` の値を指定します（デフォルト: `ϵ = 0.1`）。

`sdegzer = δ` は、ゼロシフトのために指定された安定性次数 `δ` を指定します（デフォルト: 連続時間システム `sysf.sys` に対して `δ = −0.05`、離散時間システム `sysf.sys` に対して `δ = 0.95`）。

`nonstd = job` は、非標準最適化問題を処理するオプションを指定します。次のようになります。

```
  job = 1 – 擬似共外共内因子分解を使用（デフォルト）;
  job = 2 – 正則化パラメータ `ϵ` を使用した修正共外共内因子分解;
  job = 3 – ウィーナーホフ型共外共内因子分解を使用;
  job = 4 – 安定化パラメータ `δ` を使用して非最小位相因子のゼロシフトを行うウィーナーホフ型共外共内因子分解を使用;
  job = 5 – 正則化パラメータ `ϵ` を使用して非最小位相因子の正則化を行うウィーナーホフ型共外共内因子分解を使用。
```

実施された削減におけるランクの決定は、`fast = true` の場合は列ピボットを伴うランクを明らかにする QR 分解に基づいており、`fast = false` の場合はより信頼性の高い SVD 分解に基づいています。

キーワード引数 `atol1`、`atol2`、および `rtol` は、それぞれ `A`、`B`、`C`、`D` の非ゼロ要素の絶対許容誤差、`E` の非ゼロ要素の絶対許容誤差、および `A`、`B`、`C`、`D` および `E` の非ゼロ要素の相対許容誤差を指定します。デフォルトの相対許容誤差は `n*ϵ` であり、ここで `ϵ` は作業機械エプシロンで、`n` はシステム `sysf.sys` の次数です。キーワード引数 `atol3` は、可観測性テストの絶対許容誤差です（デフォルト: 内部で決定された値）。キーワード引数 `atol` は、同時に `atol1 = atol`、`atol2 = atol` および `atol3 = atol` を設定するために使用できます。

結果として得られた名前付きタプル `info` には `(tcond, degs, degs2, S, S2, HDesign, HDesign2, freq, gap)` が含まれます。ここで：

`info.tcond` は、使用された非直交変換行列の条件数の最大値です。`info.tcond >= tcmax` の場合は警告が発行されます。

`info.degs` は、`G1(λ) := [ Gu(λ) Gd(λ); I 0]` の左最小多項式ヌル空間基底の次数を増加順に含む整数ベクトルです（`G1(λ)` の左クロンカーインデックスでもあります）。この情報は、`minimal = true` の場合に `Q1(λ)` と `R1(λ)` のコンポーネントの最小次数を決定するために使用されます。

`info.degs2` は、`G2(λ) := [ Gu(λ) Gd(λ) Gw(λ); I 0 0]` の左最小多項式ヌル空間基底の次数を増加順に含む整数ベクトルです（`G2(λ)` の左クロンカーインデックスでもあります）。この情報は、`minimal = true` の場合に `Q2(λ)` と `R2(λ)` のコンポーネントの最小次数を決定するために使用されます。

`info.S` は、計算された左ヌル空間基底に対応する縮小システムのバイナリ構造行列です。

`info.S2` は、計算された左ヌル空間基底に対応する縮小システムのバイナリ構造行列です。

`info.HDesign` は、故障検出フィルタのコンポーネント `Q1(λ)` と `R1(λ)` の合成に使用される設計行列 `H1` です。

`info.HDesign2` は、故障検出フィルタのコンポーネント `Q2(λ)` と `R2(λ)` の合成に使用される設計行列 `H2` です。

`info.freq` は、フル行ランク許容条件をチェックするために使用される周波数値です。

`info.gap` は、達成されたギャップ `∥Rf(λ)∥∞−/∥Rw(λ)∥∞` であり、H−マイナスインデックスは、`FDfreq = missing` の場合は全周波数範囲にわたって計算され、`FDfreq = freq` の場合は `freq` に含まれる周波数値にわたって計算されます。

*メソッド:* [1] の手続き AFD の拡張が実装されており、近似故障検出問題を解決します（[2] および [1] の注釈 5.10 も参照）。使用される正則化アプローチは、修正共外共内因子分解に基づいており、[3] で議論されています。実装されたメソッドの詳細については、[4] の *afdsyn* 関数のドキュメントを参照してください。

*参考文献:*

[1] A. Varga, Solving Fault Diagnosis Problems - Linear Synthesis Techniques.                Springer Verlag, 2017; sec. 5.3.

[2] A. Varga, General computational approach for optimal fault detection.                Proc. IFAC Symposium SAFEPROCESS, Barcelona, Spain, pp. 107–112, 2009.

[3] K. Glover and A. Varga, On solving non-standard H-/H_2/inf fault detection problems.                Proc. IEEE CDC, Orlando, FL, USA, pp. 891–896, 2011.

[4] A. Varga, Fault Detection and Isolation Tools (FDITOOLS) User's Guide,                [arXiv:1703.08480](https://arxiv.org/pdf/1703.08480).  ```
