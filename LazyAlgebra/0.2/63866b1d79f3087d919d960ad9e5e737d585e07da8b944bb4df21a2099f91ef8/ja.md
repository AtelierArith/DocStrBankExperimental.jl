# 線形共役勾配法

```julia
conjgrad!(x, A, b, [x0=vfill!(x,0), p, q, r]) -> x
```

は、反復的な共役勾配法を用いて、`x0`から始めて対称線形系 `A⋅x = b` の近似解を見つけます。結果は `x` に格納され、返されます。

引数 `A` は、対称正定値線形写像 `A` を実装しており、Julia配列（一般的な行列として解釈される、[`GeneralMatrix`](@ref)を参照）として、[`LinearMapping`](@ref)のインスタンスとして、または次のように使用される呼び出し可能オブジェクト（関数のようなもの）として提供できます：

```julia
A(dst, src)
```

これは `dst` を `A⋅src` で上書きします。もし `A` が呼び出し可能オブジェクトとして実装されていて、`A(x)` が `A⋅x` を返す場合、インライン関数を使って `conjgrad!` を呼び出します：

```julia
conjgrad!(x, (dst,src) -> (dst .= A(src); return dst), b, ...)
```

初期変数が指定されていない場合、デフォルトではすべての変数がゼロに設定されて開始されます。

オプションの引数 `p`、`q`、`r` は書き込み可能なワークスペース *ベクトル* です。返されるとき、`p` は最後の探索方向、`q = A⋅p`、`r = b - A⋅xp` で、`xp` は前のまたは最後の解です。提供された場合、これらのワークスペースは異なる必要があります。すべての *ベクトル* は同じサイズでなければなりません。すべてのワークスペースベクトルが提供されている場合、他のメモリ割り当ては必要ありません（`A` が一時的なメモリを割り当てる必要がない限り）。

`A` が正定値である限り、方程式 `A⋅x = b` の解 `x` は二次関数の最小値でもあります：

```
f(x) = (1/2) x'⋅A⋅x - b'⋅x + ϵ
```

ここで `ϵ` は任意の定数です。連続する反復間の `f(x)` の変化、`f(x)` の勾配のノルム、または `x` の変化を使用してアルゴリズムの収束を決定できます（以下のキーワード `ftol`、`gtol`、`xtol` を参照）。

## メモリの節約

メモリを節約するために、`x` と `x0` は同じオブジェクトであることができます。そうでない場合、再起動が発生しない限り（以下のキーワード `restart` を参照）、`b` も `r` と同じであることができますが、これは推奨されません。

## キーワード

アルゴリズムを制御するためのいくつかのキーワードがあります：

  * キーワード `ftol` は収束のための関数の許容誤差を指定します。収束は、二つの連続する反復間の目的関数 `f(x)` の変化が、これまでの最大変化の `ftol` 倍以下であるときに仮定されます。デフォルトでは、`ftol = 1e-8` です。
  * キーワード `gtol` は収束のための勾配の許容誤差を指定します。これは二つの値 `(gatol, grtol)` のタプルで、絶対許容誤差と相対許容誤差です。収束は、残差のユークリッドノルム（関連する目的関数の勾配のノルム）が、初期残差のユークリッドノルムの `gatol` と `grtol` の最大値の倍以下であるときに発生します。デフォルトでは、`gtol = (0.0, 0.0)` です。
  * キーワード `xtol` は収束のための変数の許容誤差を指定します。収束は、変数の変化のユークリッドノルムが、変数 `x` のユークリッドノルムの `xtol` 倍以下であるときに仮定されます。デフォルトでは、`xtol = 0` です。
  * キーワード `maxiter` は最大反復回数を指定します。デフォルトでは実質的に無制限です。
  * キーワード `restart` は、アルゴリズムを再起動する前の最大反復回数を設定できます。デフォルトでは、`restart` は `50` と変数の数の最小値に設定されます。再起動が発生しないようにするには、`restart` を少なくとも `maxiter` に設定してください。
  * キーワード `strict` は、非正定値演算子 `A` が `NonPositiveDefinite` 例外をスローするか、これまでに見つかった最良の解を返すかを指定するためにブール値（デフォルトは `true`）に設定できます（`quiet` が false の場合は警告が表示されます）。
  * キーワード `quiet` は、警告メッセージを表示するかどうかを指定するためにブール値（デフォルトは `false`）に設定できます。

参照： [`conjgrad`][@ref)。
