`R` を実ベクトル空間 `V` の根系とします。`F₀∈ GL(V)` が `R` の *自己同型* であるとは、`R` を置換し、有限の順序を持つ場合（有限の順序は `R` が `V` を生成する場合に自動的に成り立ちます）を言います。 [chap. VI, §1.1, lemme 1 Bourbaki1968](biblio.htm#Bou68) によれば、双対 `F₀*∈ GL(V*)` はコルート `R*⊂ V*` を置換します。したがって、`F₀` は `R` に関連する反射群 `W` を正規化します。すなわち、`w↦ F₀wF₀⁻¹` は `W` の自己同型です。これにより、反射コセット `WF₀` が得られ、これを *コクセターコセット* と呼びます。

コクセターコセットを導入する動機は、代数的冗長群の自己同型から生じ、有限体上の非分裂冗長群を生じることにあります。`𝐆` を有限体 `𝔽_q` の代数的閉包 `𝔽̄_q` 上の連結冗長代数群とし、`𝔽_q` 上で定義されるとします。これは、有限体の有理点の有限群 `𝐆(𝔽_q)` が `F` の下での不変点の部分群 `𝐆^F` に同一視されることに対応します。

`𝐓` を `𝐆` の最大トーラスとし、`Φ`（または `Φ*`）を `𝐓` に関する `𝐆` の根（またはコルート）とします。すると、`𝐆` は `(X(𝐓),Φ,Y(𝐓),Φ*)` によって同型まで決定されます。これは、ベクトル空間 `V=ℚ ⊗ X(𝐓)` における根系と、これに作用する有理反射群 `W=N_𝐆(𝐓)/𝐓` を与えます。

もし `𝐓` が `F`-安定であれば、フロベニウス自己同型 `F` は `X(T)` に自然に作用し、したがって `V` の自己同型を定義します。この自己同型は `q F₀` の形を持ち、ここで `F₀∈ GL(V)` は有限の順序を持ち、`W` を正規化します。したがって、コクセターコセット `WF₀⊂GL(V)` が得られます。データ `(X(𝐓), Φ, Y(𝐓), Φ*, F₀)` と整数 `q` は、関連する *冗長有限群* `𝐆^F` を同型まで完全に決定します。したがって、これらのデータは有限冗長群を決定する本質的な情報を表現する方法です。実際、シェヴァレ群のすべての性質はそのデータから計算できます：文字を表す記号、共役類、そして最終的には `𝐆^F` の全文字表です。

このデータに付随する多くの興味深い対象は、`(V,W, F₀)` のみに依存します：最大トーラスの順序、*擬似次数*、`𝐆^F` の順序、単純な文字を表す記号、*ほぼ文字* に関するデリーニュ-ルスツィグ誘導、文字とほぼ文字を関連付けるフーリエ行列などです…（例えば、[Broue-Malle-Michel1993](biblio.htm#BMM93) を参照）。したがって、これらの構成を非結晶群（あるいはより一般的な複素反射群、[`spets`](@ref) を参照）に拡張することが可能です。これが、反射コセットの定義に根系を含めなかった理由です。しかし、例えば単純共役類は根系に依存します。

今、`𝐓` が `𝐆` の `F`-安定ボレル部分群に含まれていると仮定します。これにより、根に対する順序が定義され、正の根の集合を保持するコセットの *縮約要素* `ϕ∈ W F₀` が一意に存在します。これにより、コクセター系 `(W,S)` の *図式自己同型* が定義されます。この要素はコセットレコードのコンポーネント `.phi` に格納されます。根を言及せずに次のように定義できます：`(W,F₀(S))` は別のコクセター系であり、したがって `S` によって `W` の一意の要素によって共役です。したがって、`S` を安定化する一意の要素 `ϕ∈ WF₀` が存在します（証明は [Theoreme 1, chap. V, §3 Bourbaki1968](biblio.htm#Bou68) に従います）。したがって、`S` を安定化する `ϕ` のコセット `Wϕ` を考えます。コセット `W ϕ` は、`𝐆` が半単純である場合、すなわち `Φ` が `V` を生成する場合に、置換 `.phi` によって完全に定義されます。この場合、コセットを定義するためには `phi` を指定するだけで済みます。

上記の設定にはわずかな一般化があり、特にリー群とスズキ群のケースをカバーします。`F` がフロベニウス自己同型ではなく、ある冪 `F^n` がフロベニウス自己同型であるような同型を考えます。この場合、`F` は依然として `W` を正規化する `V` の自己同型を定義します。`F^n` が `𝔽_{qⁿ}`-構造に付随するような実数 `q` を定義します。したがって、`F=q F₀` であり、ここで `F₀` は有限の順序を持ちますが、`q` はもはや整数ではありません。したがって、`F₀∈ GL(V⊗ ℝ)` ですが、`F₀∉ GL(V)` です。例えば、リー群とスズキ群の場合、`F₀` は `W` の順序 `2` の自己同型であり、これはタイプ `G₂`、`B₂` または `F₄` であり、`B₂` と `F₄` の場合は `q=√2`、`G₂` の場合は `q=√3` です。このような根系は、すべての根が同じ長さを持つ `G₂`、`B₂` または `F₄` の根系から構成できます。この種の根系は *結晶的* ではありません。このような非結晶的根系は、二面体群、`H₃` および `H₄` のようなすべての有限コクセター群に存在します。ここでは、代数群の有理形式に対応するコセットを *ワイルコセット* と呼びます。これには、したがって `B₂`、`G₂` および `F₄` の非有理根系が含まれます。

## スペッツ

次に、上記の概念を一般の複素反射群に拡張します。`W⊂ GL(V)` をベクトル空間 `V` 上の複素反射群とします。`ϕ` を `W` を正規化する `GL(V)` の要素とします。すると、コセット `Wϕ` は反射コセットと呼ばれます。

これらのコセットに関する参考文献は [Broue-Malle-Michel 1999](biblio.htm#BMM99) です。`W` がいわゆる *スペツィアル* 群である場合、これらは *スペッツ* の構成の基本的な対象であり、これは複素反射群に付随し、有限冗長群と共有される属性を組み合わせ的に導出することができます。例えば、単純次数などです…。

反射コセットが irreducible であるとは、`W` が irreducible である場合を言います。一般のコセットは *スカラーの降下* の直積であり、これは `ϕ` が `W` の irreducible 成分に対して推移的である場合です。irreducible コセットは [Broue-Malle-Michel 1999](biblio.htm#BMM99) で分類されています：`ϕ` をスカラーで乗算することを除けば、通常、与えられた irreducible 群に対して可能なコセットは一つまたは二つだけです。

私たちは *有限の順序* コセットのみを扱います。すなわち、(最小の) 整数 `δ` が存在し、`(Wϕ)^δ=W` となると仮定します。したがって、`W` と `ϕ` によって生成される群は有限であり、順序は `δ|W|` です。

`Wϕ` の部分集合 `C` は、次のいずれかの同値条件が満たされる場合に *共役類* と呼ばれます：

  * `C` は `W` の共役作用の下での `Wϕ` の要素の軌道です。
  * `C` は `Wϕ` に含まれる `⟨W,ϕ⟩` の共役類です。
  * 集合 `{w∈ W|wϕ∈ C}` は `W` の `ϕ`-共役類です（2つの要素 `v,w∈ W` は、`v=xwϕ(x⁻¹)` を満たす `x∈ W` が存在する場合に限り、`ϕ`-共役であると呼ばれます）。

`⟨W,ϕ⟩` の irreducible 文字は、`Wϕ` 上で非ゼロの値を持つ場合、`W` に対する制限が irreducible である場合に限ります。さらに、`W` に対する同じ irreducible 制限を持つ2つの文字 `χ₁` と `χ₂` は、循環群 `⟨ϕ⟩` の文字によって異なります（これは商 `⟨W,ϕ⟩/W` に同一視されます）。`W` の各 `ϕ`-不変文字の `⟨W,ϕ⟩` への拡張を含む集合は、`Wϕ` の *irreducible 文字の集合* と呼ばれます。このような2つの文字は、`Wϕ` 上のクラス関数に対するスカラー積によって直交します。すなわち、$⟨χ,ψ⟩:=|W|¹∑_{w∈ W}χ(wϕ)\overline{ψ(wϕ)}$ です。有理群（ワイル群）に対して、ルスツィグは `Wϕ` のための irreducible 文字の集合の選択を定義しました（これを *好ましい拡張* と呼びます）が、より一般的な反射コセットに対しては、いくつかのかなり恣意的な選択を行いましたが、これらの値は最小の可能な体に存在するという特性を持っています。

`Wϕ` の *文字表* は、`Wϕ` の共役類に対する irreducible 文字の集合の値の表です。

`Wϕ` の *部分コセット* `Lwϕ` は、`W` の反射部分群 `L` と、`w` が `L` を正規化するような `W` の要素によって与えられます。

次に、`Wϕ` 上のクラス関数の *制限* の自然な概念と、逆方向の *誘導* の概念があります。これらの写像は、上記で定義されたスカラー積に関して随伴です（[Broue-Malle-Michel 1999](biblio.htm#BMM99) を参照）。

このパッケージでは、反射データから始めて、さらに写像 `ϕ:V→ V` の行列 `F` を与えることによって、反射コセットの最も一般的な構成が行われます（コマンド `spets` を参照）。ただし、現在、一般のコセットは、根の集合上の置換群として表現される群に対してのみ実装されており、与えられた自己同型がスカラーまでこの集合を保持することが要求されます（これらのスカラーが irreducible 成分とその像のペアに依存することが許可されています）。また、根に対して誘導する置換によって `ϕ` を指定することも許可されています。この場合、`ϕ` が根の直交に対して自明に作用することが仮定されますが、根は親群のものであり、より大きな空間を生成する可能性があります。したがって、いかなる場合でも、`⟨W,ϕ⟩` の置換表現があり、コセットを置換の集合と見なします。

反射コセットは、反射群の部分コセットとして現れる非自明な `phi` を持つ最も一般的な状況で実装されています。以下は「エキゾチック」な例であり、次の章ではコクセター群に関するより古典的な例を示します。

```julia-repl
julia> W=complex_reflection_group(14)
G₁₄

julia> R=reflection_subgroup(W,[2,4])
G₁₄₍₂₄₎=G(-ζ₃²√-2)₅

julia> RF=spets(R,W(1))
G₁₄₍₂₄₎=²G(-ζ₃²√-2)₅
```

```julia-rep1
julia> diagram(RF)
ϕ acts as (1,2) on the component below
③ ══③ G₅
1   2
```

```julia-repl
julia> degrees(RF)
2-element Vector{Tuple{Int64, Cyc{Int64}}}:
 (6, 1)
 (12, -1)
```

最後の行は、各反射次数に対してコセットの対応する *因子* を示しており、これは `ϕ` が対応する基本反射不変に作用するスカラーです。因子はコセットを特徴付けます。

デフォルトでは、スペッツはそのタイプを説明する省略形で印刷されます（上記のように、`G₅` は 2 でねじれ、標準のものとは異なるカータン行列を持ちます）。関数 `repr` は、Julia に戻すことができる形式を提供します。上記と同じデータを使用して、次のようになります。

```julia-rep1
julia> print(RF)
spets(reflection_subgroup(complex_reflection_group(14),[2, 4]),perm"(1,3)(2,4)(5,9)(6,10)(7,11)(8,12)(13,21)(14,22)(15,23)(16,24)(17,25)(18,26)(19,27)(20,28)(29,41)(30,42)(31,43)(32,44)(33,45)(34,46)(35,47)(36,48)(37,49)(38,50)(39,51)(40,52)(53,71)(54,72)(55,73)(56,74)(57,75)(58,76)(59,77)(60,78)(62,79)(64,80)(65,81)(66,82)(67,69)(68,70)(83,100)(84,101)(85,102)(87,103)(89,99)(90,97)(91,98)(92,96)(93,104)(94,95)(105,113)(106,114)(109,111)(110,112)(115,118)(116,117)(119,120)")
```

コクセターコセットの共役類と irreducible 文字は、一般の反射コセットと同様に定義されます。ワイルコセットの irreducible 文字については、各 `ϕ`-安定文字に対して特定の拡張を選択します（ルスツィグに従って）、これを `W⋊ ⟨ϕ⟩` の文字と呼びます。コセット `Wϕ` の *文字表* は、好ましい拡張の `Wϕ` への制限の表です。コクセターコセットの共役類と文字表を見つける問題は、irreducible 根系 `R` の場合に還元できます。

  * 自己同型 `ϕ` は `W` の irreducible 成分を置換し、`Wϕ` は `ϕ` が `W` の irreducible 成分を循環的に置換するコセットの直積です。好ましい拡張は、これらの状況の各々における好ましい拡張の直積として定義されます。
  * さて、`Wϕ` がスカラーの降下であると仮定します。すなわち、irreducible 成分の分解 `W=W₁× ⋯ × Wₖ` が `ϕ` によって循環的に置換されます。この場合、`W` の `ϕ`-共役類から `W₁` の `ϕᵏ`-共役類への自然な全単射が存在し、`W` の `ϕ`-安定文字から `W₁` の `ϕᵏ`-安定文字への自然な全単射も存在します。これにより、`Wϕ` の好ましい拡張の定義は `W₁ϕᵏ` の定義に還元されます。
  * さて、`W` が irreducible 根系のコクセター群であると仮定します。`ϕ` は単純根を置換し、したがって対応するダイニン図にグラフ自己同型を誘導します。`ϕ=1` の場合、共役類と文字はコクセター群 `W` のそれと一致します。

結晶的根系の非自明なケースは、`ϕ` の順序がタイプに対して左の指数として書かれます：`²Aₙ`、`²Dₙ`、`³D₄`、`²E₆`。すべての根が同じ長さを持つ非結晶的根系の場合、追加のケース `²B₂`、`²G₂`、`²F₄` および `²I₂(k)` が現れます。

  * `³D₄` の場合、群 `W⋊ ⟨ϕ⟩` はタイプ `F₄` のコクセター群に埋め込むことができ、これによりコセットの共役類にラベリングが誘導されます。好ましい拡張は、有理値を持つ（単一の）拡張として選択されます。
  * `²Dₙ` の場合、群 `W⋊ ⟨ϕ⟩` はタイプ `Bₙ` のコクセター群に同型です。これにより、コセットの共役類に対する標準的なラベリングが誘導され、好ましい拡張を組み合わせ的に定義することができます。
  * 残りの結晶的ケースでは、`ϕ` は `-w₀` に同一視され、ここで `w₀` は `W` の最長要素です。したがって、コセットの共役類と文字の標準的なラベリングが `W` のそれによって定義されます。好ましい拡張は、`-w₀` に対する文字値の符号を記述することによって定義されます。

コクセターコセットの最も一般的な構成は、`simpleRoots` と `simplecoroots` の行列によって指定されたコクセターデータから始め、さらに写像 `F₀:V→ V` の行列 `F0Mat` を与えることによって行われます（コマンド `CoxeterCoset` と `CoxeterSubCoset` を参照）。コクセター群と同様に、`Wϕ` の要素は、根系 `R` の集合に誘導する置換によって一意に決定されます。これらの置換をコクセターコセットの `要素` と見なします。

コクセターコセットは、コクセターデータレコードを指す構造体によって実装され、`F0Mat` と対応する要素 `phi` を保持する追加のフィールドを持ちます。コセット上の関数（例えば、`classinfo`）は、群コセット `W ϕ` の性質に関するものです。ただし、非ねじれコクセター群の要素に対するほとんどの定義は、`W ϕ` の要素に対して変更なしに適用されます。例えば、`wϕ∈ Wϕ` の要素の長さを、正の根を負の根に送る数として定義すると、これは `w` の長さと同じであり、すなわち `ϕ` の長さは `0` です。なぜなら、`ϕ` は正の根の集合を保持するように選ばれているからです。同様に、`wϕ` を記述するコクセター `word` は、`w` のものと同じです…。

コクセターコセット `Wϕ` に対して、*ねじれたダイニン図* を関連付けます。これは、`W` のダイニン図と、`ϕ` によってこの図に誘導されるグラフ自己同型から構成されます（これは、上記で言及した群 `W⋊ ⟨F⟩` を同型まで指定します）。コクセターコセットに対しては、関数 `refltype`、`print` および `diagram` を参照してください。

以下は、スズキ群のワイルコセットを *定義しない* 方法と *定義する* 方法を示す例です。

```julia-repl
julia> W=coxgroup(:B,2)
B₂

julia> spets(W,Perm(1,2))
ERROR: matrix F must preserve the roots
Stacktrace:
 [1] error(::String) at ./error.jl:33
 [2] spets(::Chevie.Weyl.FCG{Int16,Int64,PRG{Int64,Int16}}, ::Matrix{Int64}) at /home/jmichel/julia/Chevie/src/Cosets.jl:241 (repeats 2 times)
 [3] top-level scope at REPL[19]:1

julia> W=coxgroup(:Bsym,2)
Bsym₂

julia> WF=spets(W,Perm(1,2))
²Bsym₂

julia> CharTable(WF)
CharTable(²Bsym₂)
┌───┬─────────┐
│   │    1 121│
├───┼─────────┤
│2. │1   1   1│
│.11│1  -1  -1│
│1.1│. -√2  √2│
└───┴─────────┘
```

`Wϕ` の *部分コセット* `Hwϕ` は、`W` の反射部分群 `H` と、`w` が `H` の根系の自己同型を誘導するような `W` の要素によって与えられます。代数群の場合、これは最大ランクの冗長部分群の有理形式に対応します。例えば、`Wϕ` が代数群 `𝐆` に対応し、`H` が自明な部分群である場合、コセット `Hwϕ` はタイプ `w` の最大トーラス `𝐓_w` に対応します。

```julia-repl
julia> W=coxgroup(:Bsym,2)
Bsym₂

julia> WF=spets(W,Perm(1,2))
²Bsym₂

julia> subspets(WF,Int[],W(1))
²Bsym₂₍₎=Φ‴₈
```

部分群 `H` が放物部分群である場合、これは `𝐆` の最大ランクのレヴィ部分群の有理形式に対応します。コマンド `twistings` は、そのようなレヴィのすべての有理形式を提供します。

```julia-repl
julia> W=coxgroup(:B,2)
B₂

julia> twistings(W,[1])
2-element Vector{Spets{FiniteCoxeterSubGroup{Perm{Int16},Int64}}}:
 B₂₍₁₎=Ã₁Φ₁
 B₂₍₁₎=Ã₁Φ₂

julia> twistings(W,[2])
2-element Vector{Spets{FiniteCoxeterSubGroup{Perm{Int16},Int64}}}:
 B₂₍₂₎=A₁Φ₁
 B₂₍₂₎=A₁Φ₂
```

短い根によって生成される部分群と長い根によって生成される部分群を区別することに注意してください。一般の `H` は最大ランクの冗長部分群に対応します。ここでは、`B₂` の長い根によって生成される部分群を考え、`SP₄` におけるタイプ `SL₂× SL₂` の部分群に対応する可能性のある有理形式を示します。

```julia-repl
julia> W=coxgroup(:B,2)
B₂

julia> twistings(W,[2,4])
2-element Vector{Spets{FiniteCoxeterSubGroup{Perm{Int16},Int64}}}:
 B₂₍₂₄₎=A₁×A₁
 B₂₍₂₄₎=(A₁A₁)
```
