有限コクセター群は、実ベクトル空間 `V` 上で定義できる有限複素反射群です。

*ワイル群*は、有理ベクトル空間 `V` 上で定義できる有限コクセター群です（したがって整数上でも定義されます）。

有限複素反射群と同様に、有限コクセター群は根の集合の置換の群として実装されます。ワイル群の特定の*結晶的*根系は、半単純リー代数や代数群を分類するため、数学において重要な役割を果たします。

正確な定義を与えましょう。`V` を実ベクトル空間、`Vⱽ` をその双対とします。*根系*は、ベクトルの有限集合 `R⊂ V`（*根*）と、`R` から `Vⱽ` の部分集合 `Rⱽ` への写像 `r↦ rⱽ`（*コルート*）の組であり、次の条件を満たします：

  * 任意の `r∈ R` に対して、`rⱽ(r)=2` であるため、式 `x↦ x-rⱽ(x)r` は根 `r` とコルート `rⱽ` を持つ反射 `sᵣ:V→ V` を定義します。
  * 反射 `sᵣ` は `R` を安定化します。

`GL(V)` の部分群 `W=W(R)` は、`r∈ R` に対する反射 `sᵣ` によって生成される有限コクセター群です。*縮約*根系を要求します。つまり、`R` の中で `r∈ R` と共線である要素は `r` と `-r` のみです。ワイル群の場合、根系が*結晶的*であることも要求します。すなわち、任意の `s∈ R,rⱽ∈ Rⱽ` に対して `rⱽ(s)` が整数である必要があります。

`V` を `Vⱽ` と同一視し、`W` 不変な二次形式 `(.;.)` を選ぶと、`rⱽ=2r/(r;r)` となります。根系 `R` は、`R` が二つの直交部分集合の和でない場合に*不可約*です。言い換えれば、`R` によって生成される部分空間上の `W` の表現は不可約です。`R` が可約である場合、対応するコクセター群は `R` の不可約成分に関連するコクセター群の直積です。

次に、根系 `R` と対応する `W` の表現がカータン行列またはダインキン図にどのようにエンコードされるかを説明します。`V` 上の任意の要素に消えない線形形式を選ぶことができます。この線形形式の根 `r ∈ R` に対する値の符号に応じて、`r` を*正*または*負*と呼びます。次に、正の根の一意の部分集合 `Π`、すなわち*単純根*が存在し、任意の正の根は `Π` の根の非負係数の線形結合です。異なる線形形式の選択に対応する任意の二つの単純根の集合は、`W(R)` の一意の要素によって互いに変換できます。`S` が単純根に関する反射の集合である場合、`(W,S)` はコクセター系です。これらの生成反射は*コクセター生成子*または*単純反射*と呼ばれます。

`V` と `Vⱽ` の間のペアリングは `W` 不変であるため、`Π` が単純根の集合であり、*カータン行列*を `C={rⱽ(r')}`（`r,r'∈Π` の場合）として定義すると、この行列は選択した線形形式に依存せず、行と列の同時置換を除いて独立です。`r,r'∈Π` に対する `sᵣ` の `r'` に対する作用は `sᵣ(r')=r'-C(r,r')r` で与えられるため、カータン行列は `W` の反射表現を決定します。

結晶的根系の場合、カータン行列は整数のエントリを持ち、基底 `Π`（直交基底で補完された）において、`sᵣ` は整数行列を持ちます。すべての有限次元（複素）表現は、カータン行列のエントリによって生成される体上で実現できます。

カータン行列は、重み付きエッジを持つ木であり、偶数の重み >2 のエッジに方向性を持つ*ダインキン図*にエンコードされます。頂点は単純反射によってインデックス付けされ、`s` と `t` の間にエッジが描かれるのは、`st` の順序 `mₛₜ` が `2` より大きい場合であり、その重みは `mₛₜ` です。これらの重みは、重み 3 の場合は単一のエッジ、重み 4 の場合は二重のエッジ、重み 6 の場合は三重のエッジとして描画することでエンコードされます。矢印は、異なる `W` の軌道間で異なる可能性のある相対的な根の長さを示します。あるいは、ダインキン図はカータン行列から次のように得られます：`Cᵣₛ` と `Cₛᵣ` が整数であり、`|Cₛᵣ|≥|Cᵣₛ|=1` である場合、`r` から `s` への重み `|Cₛᵣ|` のエッジがあり、`|Cₛᵣ|>1` の場合は `s` に向かって矢印が指します。ここで考慮するカータン行列は必ずしも対称ではないことに注意してください。一般のコクセター群の反射表現を記述する際に考慮したカータン行列とは異なります。対称であることは、すべての根が同じ長さであることに対応します。

不可約結晶的根系は、次のダインキン図のリストによって分類されます。ノードのラベリングは生成子の順序であり、関数 `diagram` によって示されます。

```
Aₙ O—O—O—…—O   Bₙ O⇐ O—O—…—O  Cₙ O⇒ O—O—…—O  Dₙ O 2
   1 2 3 … n      1  2 3 … n     1  2 3 … n     ￨
                                              O—O—…—O
                                              1 3 … n

G₂ O⇛ O  F₄ O—O⇒O—O    E₆  O 2    E₇  O 2      E₈  O 2
   1  2     1 2 3 4        ￨          ￨            ￨
                       O—O—O—O—O  O—O—O—O—O—O  O—O—O—O—O—O—O
                       1 3 4 5 6  1 3 4 5 6 7  1 3 4 5 6 7 8
```

矢印を無視すると、基礎となるワイル群を記述する*コクセター図*が得られます。根系 `B_n` と `C_n` は同じコクセター群に対応します（コクセター図は*コクセターマトリックス*によって定義されます）。ワイル群は、コクセターマトリックスのすべての非対角エントリが `{2,3,4,6}` にある有限コクセター群としても特徴付けられます。

結晶的でない有限コクセター群のコクセター図は次の通りです（`I₂(e)` は `e∉ {2,3,4,6}` の場合、結晶的ではありません）。

```
       e        5         5
I₂(e) O—O   H₃ O—O—O  H₄ O—O—O—O
      1 2      1 2 3     1 2 3 4
```

関数 `cartan` は、不可約根系のカータン行列を与えます。

```julia-repl
julia> cartan(:D,4)
4×4 Matrix{Int64}:
  2   0  -1   0
  0   2  -1   0
 -1  -1   2  -1
  0   0  -1   2

julia> cartan(:I,2,5) # 型 I₂(e) の場合、e を3番目の引数として与えます
2×2 Matrix{Cyc{Int64}}:
       2  ζ₅²+ζ₅³
 ζ₅²+ζ₅³        2
```

二つのカータン行列 `c1` と `c2` が与えられた場合、それらの行列の直和（根系の直交直和に対応する）は `cat(c1,c2,dims=[1,2])` によって得られます。

単純根と対応するコルートから全根系を復元できます。なぜなら、各根は単純根の軌道にあるからです。単純反射の `R` に対する制限はカータン行列によって決定されるため、`R` はカータン行列と単純根の集合によって決定されます。

関数 `rootdatum` は、単純根のリストを表す行列 `r` と対応するコルートを表す別の行列 `cr` を引数として取り、`FiniteCoxeterGroup` を生成します。このようなオブジェクトは、根系の記述に加えて置換群を含みます。`cr*transpose(r)` はカータン行列であるべきです。コクセター群の各要素は、根に対して誘導する置換として表され、正の根は `1:N` でラベル付けされ、負の根は `N+1:2N` でラベル付けされます。

`rootdatum` に単一の行列引数が与えられた場合、それは `cr` と見なされ、`r` は単位行列と見なされます。この場合、根は `V` の標準基底となる特定の根系が得られます。便宜上、`rootdatum(cartan(t...))` は `coxgroup(t...)` に簡略化できます。

```julia-repl
julia> W=coxgroup(:D,4) # rootdatum(cartan(:D,4)) と同じ
D₄

julia> cartan(W)
4×4 Matrix{Int64}:
  2   0  -1   0
  0   2  -1   0
 -1  -1   2  -1
  0   0  -1   2
```

また、不可約根系の直和に関連する `FiniteCoxeterGroup` は次のように得られます。

```julia-repl
julia> W=coxgroup(:A,2)*coxgroup(:B,2)
A₂×B₂

julia> cartan(W) # cat(cartan(:A,2), cartan(:B,2),dims=[1,2] と同じ
4×4 Matrix{Int64}:
  2  -1   0   0
 -1   2   0   0
  0   0   2  -2
  0   0  -1   2
```

ワイル群の要素は根の置換です：

```julia-repl
julia> W=coxgroup(:D,4)
D₄

julia> p=W(1,3,2,1,3) # 24根を置換します
(1,14,13,2)(3,17,8,18)(4,12)(5,20,6,15)(7,10,11,9)(16,24)(19,22,23,21)

julia> word(W,p)
5-element Vector{Int64}:
 1
 3
 1
 2
 3
```

最後に、julia 1.0.2 でのベンチマークです。

```benchmark
julia> @btime length(elements(coxgroup(:E,7)))
  531.385 ms (5945569 allocations: 1.08 GiB)
```

同じ計算に対してGAP3は2.2秒かかります。
