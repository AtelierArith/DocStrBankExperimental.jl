```
(new_trace, weight, retdiff, discard) = update(trace, args::Tuple, argdiffs::Tuple,
                                               constraints::ChoiceMap)
```

引数を変更したり、既存のランダム選択肢のいくつかに新しい値を提供したり、新たに導入されたランダム選択肢に値を提供することで、トレースを更新します。

以前のトレース $(x, r, t)$ (`trace`)、新しい引数 $x'$ (`args`)、およびマップ $u$ (`constraints`) を考慮して、一貫性のある新しいトレース $(x', r', t')$ (`new_trace`) を返します。$t'$ の選択肢の値は、$t$ からコピーされるか、$u$ から（$u$ が優先される）取得されるか、内部提案分布からサンプリングされます。$u$ のすべての選択肢は $t'$ に現れなければなりません。また、$u$ からの値で上書きされた $t$ の選択肢や、$t'$ にアドレスが現れない $t$ の選択肢を含む割り当て $v$ (`discard`) も返します。$t' \sim q(\cdot; x', t + u)$、および $r' \sim q(\cdot; x', t')$ をサンプリングします。ここで、$t + u$ は $t$ と $u$ をマージして得られる選択マップで、重複するアドレスに対しては $u$ が優先されます。また、重み (`weight`) も返します：

$$
\log \frac{p(r', t'; x')}{q(r'; x', t') q(t'; x', t + u)}
- \log \frac{p(r, t; x)}{q(r; x, t)}
$$

`argdiffs` は `args` と同じ長さであることが期待されます。`trace` を生成した関数が末尾の引数に対してデフォルト値をサポートしている場合、これらの引数は `args` および `argdiffs` から省略できます。元の `trace` が非デフォルトの引数値を使用して生成された場合、省略された各オプション引数について、古い値は更新されたトレースのデフォルト引数値で上書きされます。
