```
quarnetGoFtest!(net::HybridNetwork, df::DataFrame, optbl::Bool; quartetstat=:LRT, correction=:simulation, seed=1234, nsim=1000, verbose=false, keepfiles=false)
quarnetGoFtest!(net::HybridNetwork, dcf::DataCF,   optbl::Bool; kwargs...)
```

マルチ種ネットワークコアレセントの適合度検定で、特定の集団または種ネットワークがクワーテットの一致係数データを適切に説明しているかどうかを確認します。ネットワークは最大でレベル1である必要があり（木はこの条件を満たします）、枝の長さはコアレセント単位である必要があります。この検定は、観測されたクワーテット一致係数（CF）に対して多項分布を仮定しており、各4タクソンセットの遺伝子数に関する情報（`ngenes`フィールド）が存在する必要があります。

各4タクソンセットについて、外れ値p値は、テスト統計量（デフォルトでは-2対数尤度比）を自由度2のカイ二乗分布と比較することによって得られます（他のオプションについては以下を参照）。

その後、4タクソンセットは、外れ値p値に基づいて外れ値かどうかに分類されます（p<0.05の場合は外れ値）。最後に、外れ値4タクソンセットの頻度に対して片側の適合度検定が行われ、期待されるよりも外れ値が多いかどうかを確認します。この検定のz値は、5%の外れ値p値が< 0.05であるという帰無仮説に対応します（5%を超える場合）：

$$
z = \frac{\mathrm{proportion.outliers} - 0.05}{\sqrt{0.05 \times 0.95/\mathrm{number.4taxon.sets}}}.
$$

このz値は、4タクソンセット間で独立した外れ値p値を仮定する検定に対応します：依存性の修正は行われません。

依存性を修正するために`correction=:simulation`を使用すると、ネットワークに沿ったコアレセントの下で遺伝子木をシミュレーションすることによってz値の分布が得られます（`optbl=true`の場合は枝長の最適化後）。[PhyloCoalSimulations](https://github.com/cecileane/PhyloCoalSimulations.jl)を使用します。zスコアは各シミュレーションデータセットで計算されます。独立性の下では、これらのzスコアは平均0、分散1を持ちます。依存性の下では、これらのzスコアは依然として平均0を持ちますが、分散が膨張します。この分散σ²はシミュレーションから推定され、修正されたp値は元のz値をN(0,σ²)と比較することによって得られます。`correction=:none`の場合、σは1（独立性）と見なされます：*推奨されません！*

  * 最初のバージョンは、各行が特定の4タクソンセットに対応する`DataFrame`を受け取ります。データフレームは、各4タクソンセットに対応するp値を含む追加の列を持つように修正されます。
  * 2番目のバージョンは`DataCF`オブジェクトを受け取り、そのオブジェクトに格納されている期待される一致係数を更新することによって修正します。

`net`は**変更されません**。

# 引数

  * `optbl`：`false`の場合、`net`の枝の長さはそのまま使用され、コアレセント単位である必要があります。`optbl=true`の場合、`net`の枝の長さは最適化され、SNaQのように擬似対数尤度スコアを最適化します（[こちら](https://crsl4.github.io/PhyloNetworks.jl/stable/lib/public/#PhyloNetworks.topologyMaxQPseudolik!)を参照）。どちらの場合も、欠落している枝の長さは[`ultrametrize!`](@ref)を使用して値が割り当てられ、主要な木を超距離的にしようとします（ただし、既存のエッジの長さは決して変更しません）。欠落している枝の長さは、タクソンごとに単一のアレルがある場合など、同定できない場合に発生する可能性があります。ネットワークは出力の一部として返されます。

# キーワード引数

  * `quartetstat`：各4タクソンセットの外れ値p値を取得するために使用されるテスト統計量で、次に自由度2のカイ二乗分布と比較してp値を取得します。

      * `:LRT`はデフォルトで、尤度比のためのものです：$2n_\mathrm{genes} \sum_{j=1}^3 {\hat p}_j (\log{\hat p}_j - \log p_j)$、ここで$p_j$はネットワークから期待されるクワーテットCFであり、${\hat p}_j$はデータで観測されたクワーテットCFです。
      * `:Qlog`はQlog統計（Lorenzen, 1995）のためのものです：$2n_\mathrm{genes} \sum_{j=1}^3 \frac{({\hat p}_j - p_j)^2}{p_j (\log{\hat p}_j - \log p_j)}$および
      * `:pearson`はピアソンのカイ二乗統計のためのもので、期待されるカウントが低い（例えば5未満）場合にうまく機能しません：$n_\mathrm{genes} \sum_{j=1}^3 \frac{({\hat p}_j - p_j)^2 }{p_j}$
  * `correction=:simulation`は4タクソン間の依存性を修正します。シミュレーションをオフにし、依存性の修正を無効にするには`:none`を使用します。
  * `seed=1234`：遺伝子木シミュレーションのシードを制御するためのマスターシード。
  * `nsim=1000`：シミュレーションされたデータセットの数。各データセットは、各4タクソンセットがデータを持つ遺伝子の中央値の数を持つようにシミュレーションされます。
  * `verbose=false`：シミュレーションの進行状況を表示し、潜在的な問題を診断するには`true`に設定します。
  * `keepfiles=false`：`true`の場合、シミュレーションされた遺伝子木がファイルに書き込まれ、1000回のシミュレーションごとに1つのファイルが作成されます。作成された場合（`keepfiles=true`）、これらのファイルは`jl_`で始まる新しく作成されたフォルダーに保存され、現在のディレクトリに配置されます。

# 出力

1. 全体の適合度検定のp値（要求された場合は依存性の修正済み）
2. 修正されていないz値テスト統計
3. 修正に使用されるテスト統計の推定σ（修正がない場合は1.0）
4. 各4タクソンセットに対する外れ値p値のベクトル
5. ネットワーク（最初と2番目のバージョン）：`optbl`がfalseの場合は更新されたloglikフィールドを持つ`net`；`optbl`がtrueの場合は最適化された枝の長さとloglikを持つ`net`のコピー
6. `correction = :simulation`の場合、シミュレーションされたz値のベクトル（`correction = :none`の場合は`nothing`）。これらのz値は、#1のp値の代わりに経験的p値を計算するために使用される可能性があります。これは、シミュレーションされたz値のうち観測されたz値（#2）以上のものの割合として計算されます。

# 参考文献

  * Ruoyi Cai & Cécile Ané (2021). マルチローカスデータに対するマルチ種ネットワークコアレセントの適合度を評価する。Bioinformatics, 37(5):634-641. doi: [10.1093/bioinformatics/btaa863](https://doi.org/10.1093/bioinformatics/btaa863)
  * Lorenzen (1995). 離散多変量データのための新しい適合度統計のファミリー。Statistics & Probability Letters, 25(4):301-307. doi: [10.1016/0167-7152(94)00234-8](https://doi.org/10.1016/0167-7152(94)00234-8)

```
