```
nni_optim!(tree::FelNode, models; <キーワード引数>)
```

すべてのブランチに対してローカルブランチスワップを再帰的に考慮し、メッセージの整合性を維持します。最初にfelsenstein!()を実行している必要があります。modelsは、ツリー上のメッセージが1つのパーティションのみを含む場合は単一のモデル、またはメッセージが>1パーティションを持つ場合はモデルの配列、またはノードを受け取り、ブランチごとにモデルを変える必要がある場合はVector{<:BranchModel}を返す関数であることができます。

# キーワード引数

  * `partition_list=nothing`: (例: 1:3 または [1,3,5]) 実行するパーティションを選択できます（ただし、すべてのモデルでツリーのトポロジーを最適化したいと思うでしょう。デフォルトオプションです）。
  * `selection_rule = x -> argmax(x)`: 現在の対数尤度と提案された対数尤度を受け取り、nni構成を選択する関数です。現在の対数尤度はx[1]に格納されていることに注意してください。
  * `sort_tree=false`: [`lazysort!`](@ref)が実行されるかどうかを決定し、初期化する必要のある一時メッセージの量を減らすことができます。
  * `traversal=Iterators.reverse`: トラバーサルを決定し、イテラブルを置換する関数です。
  * `shuffle=false`: ランダムにシャッフルされたトラバーサルを行い、`traversal`をオーバーライドします。

```
